---
output:
  word_document: default
  html_document: default
  pdf_document: default
---



<script type="text/x-mathjax-config">
MathJax.Hub.Register.StartupHook("TeX Jax Ready",function () {
  MathJax.Hub.Insert(MathJax.InputJax.TeX.Definitions.macros,{
    cancel: ["Extension","cancel"],
    bcancel: ["Extension","cancel"],
    xcancel: ["Extension","cancel"],
    cancelto: ["Extension","cancel"]
  });
});
</script>


```{r, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,comment=NA,out.width="70%",dpi=200,fig.align="center",fig.pos="H",
                      tab.cap.pre = "Table ", tab.cap.sep = ": ")

#---  for pdf output latex \{cancel}
#header-includes: \usepackage[makeroom]{cancel}
#output: pdf_document
#---
```

# 최소한의 수학지식 

이번 장에서는 생존분석을 이해하기 위해 꼭 필요한 수학적 지식에 대해 다룬다. 이번 장의 내용 중 대부분은 와쿠이 요시유키의 **법칙, 원리, 공식을 쉽게 정리한 수학사전(그린북, 2017)** 의 내용 중 생존분석에 필요한 내용을 발췌하여 기록하였다. 

## 꼭 필요한 지수의 확장

$a$를 양의 실수($a \neq 1$)라고 할 때 $a^x$를 다음과 같이 정의한다.

$(1)$ $x$가 자연수일 때
    $a^x$는 $a$를 $x$번 곱한다.

$(2)$ $x$가 0일 때
     $a^x=1$

$(3)$ $x$가 양의 정수일 때
    $a^{-x}=\frac{1}{a^x}$
    
$(4)$ $x$가 유리수 $n/m$ 일 때(단 $m,n$은 정수이며 $m>0$)
    $a^{n/m}=\sqrt[m]{a^n}$
  
(주) $\sqrt[m]A$는 $m$제곱하면 $A$가 되는 양의 수이다.
    

### 해설 

$a^x$의 의미는 $x$가 자연수일 경우 "$a$를 $x$번 곱한다"는 개념으로 설명이 가능하지만 $x$가 0, 음의 정수, 유리수, 무리수라면 이 개념으로는 설명이 불가능하다. 그러면 $2^x$를 예로 들어 지수 $x$의 확장을 살펴보자. 기본 원리는 자연수의 범위에서 성립하는 다음의 지수법칙 (A)(B)(C)이 좀 더 넓은 범위의 수에도 성립되도록 $a^x$을 정의하는 것이다.

$(A)\ a^pa^q=a^{p+q}$

$(B)\ (a^p)^q=a^{pq}$

$(C)\ (ab)^p=a^pb^p$

#### 지수 $x$가 정수일 때

$(1)$ $x$가 양의 정수(즉 자연수)일 때

이 때 $2^x$는 2를 $x$번 곱한값이 된다. 이것이 최초의 지수의 의미였다. 예를 들어 $2 ^2=2\times 2=4$이다. 

$(2)$ $x$ 가 0일 경우

(1)에 따르면 $2^0$은 2를 0번 곱한 값이 되는데 이것은 무의미하다. 그래서 $a^0=1$로 정의한다. 그 이유는 다음과 같다. 
먼저 지수법칙 (A)를 $p$에 0을 대입해도 성립한다고 가정한다. 그러면
$$a^0a^p=a^{0+p}=a^p$$
니 된다. 이 식을 $a^q(>0)$으로 나누면 $a^0=1$이 된다. 그러므로 지수법칙 (A)가 지수가 0이어도 성립하도록 $a^0=1$로 정의한다. 따라서 $2^0=1$이다.

$(3)$ $x$가 음의 정수일 경우

가령 $2^{-2}$는 "2을 -2번 곱한 값"이 되는데 이것도 말이 되지 않으므로 $a^{-n}=\frac{1}{a^n}$로 정의한다. 그 이유는 다음과 같다.

먼저 지수법칙 (A)에서 $p$가 음의 정수여도 성립한다고 가정한다. 그리고 (A)의 $p$에 $-n$, $q$에 $n$을  대입한다. 단 $n$은 양의 정수이다.  그러면 (2)에 따라 다음이 성립한다.

$$a^{-n}a^n=a^{-n+n}=a^0=1$$
이 식을 $a^n$으로 나누면 $a^{-n}=\frac{1}{a^n}$이 된다. 그러므로 지수법칙 (A)가 지수가 음의 정수여도 성립하도록 $a^{-n}=\frac{1}{a^n}$로 정의한다. 따라서 $2^{-2}=\frac{1}{2^2}=\frac{1}{4}$이 된다.

#### 지수 $x$가 유리수일 때 

예를 들어 $2^{\frac{2}{3}}$ 같은 경우 "2를 2/3번 곱한 값"이라고 생각해서는 도저히 감이 잡히지 않는다. $2^{\frac{2}{3}}$를 어떻게 정의해야 할까?

먼저 지수법칙 (B)의 $p$에 유리수 $\frac{n}{m}$을, q에 정수 m을 대입한 것이 성립한다고 가정한다. 그러면 $(a^{\frac{n}{m}})^m=a^{\frac{n}{m}m}=a^n$이며 이를 통해 "$a^{\frac{n}{m}}$은 $m$제곱하면 $a^n$인 수"라고 생각할 수 있다. 이것은 $a^n$의 $m$제곱근이다.
일반적으로 $a^{\frac{n}{m}}=\sqrt[m]{a^n}$이라고 정의한다. 단, $m,n$은 정수이며 $m>0$이다. 요컨대, $a^{\frac{n}{m}}$은  '$m$ 제곱근 $a$의 $n$제곱', 즉 $m$제곱하면 $a$의 $n$제곱이 되는 양의 수라고 정의한다.


### 예제 다음을 계산하라

$(1) 3^5\ \  (2) 3^0\ \ (3) 3^{-5}\ \  (4) 3^{1/3}\ \ (5) 3^{\frac{3}{5}}\ \  (6) 3^{-\frac{3}{5}}$


(해답)

$(1)\ 3^5=3\times 3\times 3\times 3\times 3=243$

$(2)\ 3^0=1$

$(3)\ 3^{-5}=\frac{1}{3^5}=\frac{1}{243}$

$(4)\ 3^{1/3}=\sqrt[3]{3}\approx 1.44225$(3제곱하면 2가 되는 양의 수)

$(5)\ 3^{\frac{3}{5}}=\sqrt[5]{3^3}=\sqrt[5]{27} \approx 1.933182$(5제곱하면 27이 되는 양의 수)

$(6)\ 3^{-\frac{3}{5}}=\sqrt[5]{3^{-3}}=\sqrt[5]{\frac{1}{27}}=\frac{1}{\sqrt[5]{27}} \approx 0.5172819$


## 지수함수와 성질

$(1)$ 다음의 함수를 지수함수라 한다.

$$y=a^x\ (a>0, a \neq 1)$$
$(2)$ 지수함수의 그래프

```{r,out.width="49%",fig.align='default',fig.show='hold',echo=FALSE}
x=seq(-2,2,length.out=100)
y=exp(x)
y1=1/exp(x)
df=data.frame(x,y,y1)
library(ggplot2)
ggplot(df,aes(x=x,y=y))+geom_line(color="blue",size=1)+
  theme_classic()+
  annotate("text",x=2,y=exp(2),label="italic(y==a^x)",hjust=1.3,vjust=1.3,
           family="Times",size=8,parse=TRUE)+
  geom_segment(x=0,y=-Inf,xend=0,yend=Inf,arrow=arrow(length=unit(0.2,"cm")))+
  geom_segment(x=-Inf,y=0,xend=Inf,yend=0,arrow=arrow(length=unit(0.2,"cm")))+
  annotate("text",x=0,y=0,label="0",hjust=1.3,vjust=1.3,size=6)+
  annotate("text",x=0,y=exp(0),label="1",hjust=1.3,vjust=-0.5,size=6)+
  labs(title="a>1")+
  theme(axis.line=element_blank(),axis.text=element_blank(),axis.ticks = element_blank(),
        axis.title = element_blank(),plot.title=element_text(size=16,hjust=0.5))+
  expand_limits(y=-0.5)

ggplot(df,aes(x=x,y=y1))+geom_line(color="blue",size=1)+
  theme_classic()+
  annotate("text",x=-2,y=exp(2),label="italic(y==a^x)",hjust=-1,vjust=1.3,
           family="Times",size=8,parse=TRUE)+
  geom_segment(x=0,y=-Inf,xend=0,yend=Inf,arrow=arrow(length=unit(0.2,"cm")))+
  geom_segment(x=-Inf,y=0,xend=Inf,yend=0,arrow=arrow(length=unit(0.2,"cm")))+
  annotate("text",x=0,y=0,label="0",hjust=1.3,vjust=1.3,size=6)+
  annotate("text",x=0,y=exp(0),label="1",hjust=-1,vjust=-0.5,size=6)+
  labs(title="0<a<1")+
  theme(axis.line=element_blank(),axis.text=element_blank(),axis.ticks = element_blank(),
        axis.title = element_blank(),plot.title=element_text(size=16,hjust=0.5))+
  expand_limits(y=-0.5)
```

### 해설 

함수 $y=a^x$는 지수부분에 변수 $x$가 있으므로 지수함수라고 한다. $x$가 가질수 있는 값의 범위는 실수 전체이며 $y$가 가질수 있는 값의 범위는 양의 실수이다. 참고로 $y=x^2$은 보통의 함수로 $y=2^x$와 같은 지수함수와 비슷하게 생겼지만 $x$의 위치가 다르다는 점을 주의하여야 한다.

### 예제 : 복리에 따른 원리합계

원금 1만원을 연이률 $r$의 복리로 $x$년 동안 저금하면 $x$년 후의 원리합계 $y$는 $(1+r)^x$ 만원이다. 이 때 $a=1+r$이라고 하면 $y=a^x$가 되며 이것은 지수함수이다. 아래 그림은 $r=0.01,0.02,...,0.08$일 경우에 대해 50년 후까지의 원리합계를 그래프로 나타낸 것이다. 위쪽에 위치하는 그래프일수록 이율이 높으며 연이율 8%라면($r=0.08$) 50년 후에는 거의 50배가 된다($1.08^{50} \approx 46.9$).

```{r,echo=FALSE}
x=1:50
df=data.frame(x=x)
p<-ggplot(data=df,aes(x=x))
for(i in 1:8){
    p=local({
        j=i
        y=(1+0.01*j)^x
        p+geom_line(aes(y=y),col=j,size=1)+
          annotate("text",x=50,y=(1+0.01*j)^50,label=0.01*j,hjust=-0.2)
    })  
}
p+theme_classic()+expand_limits(x=55)+
  labs(x="year",y="Total")
```
## 역함수

함수 $y=f(x)$가 있을 때 $y$의 각각의 값에 대하여 대응하는 $x$의 값이 하나 밖에 없을 경우 그 역인 함수 $x=g(y)$를 $y=f(x)$의 역함수라고 한다. 예를 들어 $y=\frac{1}{2}x+1$의 역함수는 $x=2(y-1)$이다. 

```{r,echo=FALSE,warning=FALSE}
library(ggplot2)

slope=0.5
intercept=1
x=2
y=slope*x+intercept

ggplot()+geom_abline(slope=slope,intercept=intercept,col="blue",size=1)+
  scale_x_continuous(limits = c(-1,5))+
  scale_y_continuous(limits = c(-0.5,5))+
  annotate("segment",x=x,xend=x,y=0,yend=y,
           arrow=arrow(ends="first",type="closed",angle=10,length=unit(0.1,"inches")))+
  annotate("segment",x=0,xend=x,y=y,yend=y,
           arrow=arrow(ends="first",type="closed",angle=10,length=unit(0.1,"inches")))+
  annotate("text",x=x,y=0,label="x",vjust=1.4)+
  annotate("text",x=0,y=y,label="y",hjust=1.4)+
  annotate("text",x=x,y=y/2,label=expression(italic("x=2y-2")),hjust=-0.5,parse=TRUE,family="Times",size=5)+
  annotate("text",x=x/2,y=y,label=expression(italic("y=0.5x+1")),vjust=-1,parse=TRUE,family="Times",size=5)+
   annotate("text",x=x,y=2*y,label=expression(italic("y=0.5x+1 <=> x=2y-2")),parse=TRUE,family="Times",size=5)+
  coord_equal()+
  theme_classic()+
  geom_hline(yintercept=0)+
  geom_vline(xintercept=0)+
  geom_segment(x=0,y=-Inf,xend=0,yend=Inf,arrow=arrow(length=unit(0.2,"cm")))+
  # geom_segment(x=-Inf,y=0,xend=Inf,yend=0,arrow=arrow(length=unit(0.2,"cm")))+
  #annotate("text",x=0,y=0,label="0",vjust=1.4,hjust=1.4)+
  theme(axis.line=element_blank(),axis.text=element_blank(),axis.ticks = element_blank(),
        axis.title = element_blank())
```

### 해설 : 역함수란?

함수 $y=f(x)$의 역함수가 존재하기 위해서는 조건이 필요하다. 그것은 **$y=f(x)$는 정의역에서 단조 증가하거나  단조감소한다**는 조건이다. 단조증가(monotone increasing)란 $x$가 증가하면 $y$도 증가하는 것으로 그래프가 오른쪽으로 계속 올라간다는 의미다. 반면 단조감소는 $x$가 증가하면 $y$는 반대로 감소하는 것으로 그래프가 오른쪽으로 계속 내려간다는 것이다.

```{r,out.width="49%",fig.align='default',fig.show='hold',echo=FALSE}
x=seq(-2,2,length.out=100)
y=exp(x)
y1=1/exp(x)
df=data.frame(x,y,y1)
library(ggplot2)
ggplot(df,aes(x=x,y=y))+geom_line(color="blue",size=1)+
  theme_classic()+
  annotate("text",x=0,y=exp(2),label="Monotone Increasing",vjust=1.3,
          size=8)+
  geom_segment(x=0,y=1,xend=1,yend=1,lty=2,arrow=arrow(length=unit(0.2,"cm")))+
  geom_segment(x=1,y=1,xend=1,yend=exp(1),lty=2,arrow=arrow(length=unit(0.2,"cm")))+
  annotate("text",x=0.5,y=1,label="x increase",hjust=0.5,vjust=1.5)+
  annotate("text",x=1,y=(1+exp(1))/2,label="y increase",hjust=-0.1)+
  annotate("text",x=1.8,y=exp(2),label="italic(y==f(x))",hjust=1,parse=TRUE,size=6,family="Times")+
  geom_segment(x=-Inf,y=0,xend=Inf,yend=0,arrow=arrow(length=unit(0.2,"cm")))+
  theme(axis.line=element_blank(),axis.text=element_blank(),axis.ticks = element_blank(),
        axis.title = element_blank(),plot.title=element_text(size=16,hjust=0.5))+
  expand_limits(y=-0.5)

ggplot(df,aes(x=x,y=y1))+geom_line(color="blue",size=1)+
  theme_classic()+
  annotate("text",x=0,y=exp(2),label="Monotone Decreasing",vjust=1.3,size=8)+
  geom_segment(x=-1,y=exp(1),xend=0,yend=exp(1),lty=2,arrow=arrow(length=unit(0.2,"cm")))+
  geom_segment(x=0,y=exp(1),xend=0,yend=1,lty=2,arrow=arrow(length=unit(0.2,"cm")))+
  annotate("text",x=-0.5,y=exp(1),label="x increase",hjust=0.5,vjust=-1.5)+
  annotate("text",x=0,y=(1+exp(1))/2,label="y decrease",hjust=-0.1)+
  annotate("text",x=-1.8,y=exp(2),label="italic(y==f(x))",hjust=-0.1,parse=TRUE,size=6,family="Times")+
  geom_segment(x=-Inf,y=0,xend=Inf,yend=0,arrow=arrow(length=unit(0.2,"cm")))+
  theme(axis.line=element_blank(),axis.text=element_blank(),axis.ticks = element_blank(),
        axis.title = element_blank(),plot.title=element_text(size=16,hjust=0.5))+
  expand_limits(y=-0.5)
```

### 해설2 : 증가와 감소가 섞여 있으면 역함수는 존재하지 않는다.

함수 $y=f(x)$의 정의역 안에 증가와 감소가 섞여 있으면 y가 결정되어도 이에 해당하는 x의 값이 하나가 아니라 여러 개가 존재하게 된다. 함수인 이상 대응하는 값은 하나여야 하므로 이떄 역함수는 존재하지 않는다. 그러나 정의역을 단조증가 또는 단조감소하는 부분으로 좁히면 역함수가 존재한다.

```{r,echo=FALSE}
x=seq(-2.5,3,length.out=50)
y=x^2+1
df=data.frame(x,y)
ggplot(df,aes(x=x,y=y))+geom_line(size=1,col="blue")+
  annotate("segment",x=0,xend=-2,y=5,yend=5,arrow=arrow(length=unit(0.2,"cm")),lty=2,col="red")+
  annotate("segment",x=0,xend=2,y=5,yend=5,arrow=arrow(length=unit(0.2,"cm")),lty=2,col="red")+
  annotate("segment",x=2,xend=2,y=5,yend=0,arrow=arrow(length=unit(0.2,"cm")),lty=2,col="red")+
  annotate("segment",x=-2,xend=-2,y=5,yend=0,arrow=arrow(length=unit(0.2,"cm")),lty=2,col="red")+
  annotate("segment",x=1.95,xend=1.95,y=0,yend=1.95^2+1,arrow=arrow(length=unit(0.2,"cm")),lty=2)+
  annotate("segment",x=1.95,xend=0,y=1.95^2+1,yend=1.95^2+1,arrow=arrow(length=unit(0.2,"cm")),lty=2)+
  annotate("text",x=2,y=2.5,label="italic(x==f(y))",size=6,hjust=-0.1,parse=TRUE,family="Times")+
  annotate("text",x=-2,y=2.5,label="italic(x==f(y))",size=6,hjust=1.1,parse=TRUE,family="Times")+
  annotate("text",x=-1,y=5,label="?",size=6,vjust=-1)+
  annotate("text",x=1,y=5,label="?",size=6,vjust=-1)+
  annotate("text",x=2.5,y=10,label="italic(y==f(x))",parse=TRUE,family="Times",size=6)+
  theme_classic()+
  geom_segment(x=0,y=-Inf,xend=0,yend=Inf,arrow=arrow(length=unit(0.2,"cm")))+
  geom_segment(x=-Inf,y=0,xend=Inf,yend=0,arrow=arrow(length=unit(0.2,"cm")))+
  annotate("text",x=0,y=0,label="0",hjust=1.3,vjust=1.3,size=6)+
  theme(axis.line=element_blank(),axis.text=element_blank(),axis.ticks = element_blank(),
        axis.title = element_blank(),plot.title=element_text(size=16,hjust=0.5))+
  expand_limits(y=-0.5)
```

## 로그함수

$(1)$ 지수함수 $y=a^x$ $(x>0,\ a>0,\ a \neq 1)$의 역함수를 로그함수라고 하며 $y=log_ax$라고 표기한다. 이때 $a$를 밑, $x$를 진수라고 한다.

$(2)$ 로그함수의 그래프

```{r,warning=FALSE,echo=FALSE,out.width="49%",fig.align='default',fig.show="hold",message=FALSE}
require(latex2exp)
ggplot()+ stat_function(fun=function(x){2^x},col="blue",size=1)+
  stat_function(fun=function(x){log(x,base=2)},col="blue",size=1)+
  geom_abline(intercept=0,slope=1,lty=2)+
  annotate("text",x=1.2,y=3,label=expression(italic(y==a^x)),family="Times",size=6)+
  annotate("text",x=2.6,y=0.9,label=TeX("$\\textit{y=log_ax}$"),size=6,family="Times")+
  annotate("text",x=0,y=0,label="0",size=6,hjust=1.5,vjust=-1)+
  annotate("text",x=1,y=0,label="1",size=6,hjust=1.2,vjust=-1)+
  annotate("text",x=0,y=1,label="1",size=6,hjust=1.5,vjust=-1)+
  annotate("segment",x=-Inf,xend=Inf,y=0,yend=0,arrow=arrow(length=unit(0.2,"cm")))+
  annotate("segment",x=0,xend=0,y=-Inf,yend=Inf,arrow=arrow(length=unit(0.2,"cm")))+
  theme_classic()+ylim(c(-2,3))+xlim(c(-2,3))+
  labs(title="a > 1")+
  coord_equal()+
  theme(axis.line=element_blank(),axis.text=element_blank(),axis.ticks = element_blank(),
        axis.title = element_blank(),plot.title=element_text(size=12,hjust=0.5))

ggplot()+ stat_function(fun=function(x){0.5^x},col="blue",size=1)+
  stat_function(fun=function(x){log(x,base=0.5)},col="blue",size=1)+
  geom_abline(intercept=0,slope=1,lty=2)+
  annotate("text",x=-1.5,y=3,label=expression(italic(y==a^x)),family="Times",size=6)+
  annotate("text",x=2.0,y=-1.5,label=TeX("$\\textit{y=log_ax}$"),size=6,family="Times")+
  annotate("text",x=0,y=0,label="0",size=6,hjust=1.5,vjust=-1)+
  annotate("text",x=1,y=0,label="1",size=6,hjust=1.2,vjust=1.2)+
  annotate("text",x=0,y=1,label="1",size=6,hjust=1.5,vjust=-1)+
  annotate("segment",x=-Inf,xend=Inf,y=0,yend=0,arrow=arrow(length=unit(0.2,"cm")))+
  annotate("segment",x=0,xend=0,y=-Inf,yend=Inf,arrow=arrow(length=unit(0.2,"cm")))+
  theme_classic()+ylim(c(-2,3))+xlim(c(-2,3))+
  labs(title="0 < a < 1")+
  coord_equal()+
  theme(axis.line=element_blank(),axis.text=element_blank(),axis.ticks = element_blank(),
        axis.title = element_blank(),plot.title=element_text(size=12,hjust=0.5))

```

### 로그함수는 다음과 같은 성질을 지닌다.

$(1)\ log_a1=0\ \ \ log_aa=1$

$(2)\ log_aMN=log_aM+log_aN$

$(3)\ log_a\frac{M}{N}=log_aM-log_aN$

$(4)\ log_aM^r=rlog_aM$

$(5)\ log_ab=\frac{log_cb}{log_ca}$... $c>0, c\neq1$ (밑변환공식)


### 해설

로그함수 $y=log_ax$ 의 성질을 보장하는 것은 다음의 지수의 법칙이다. 


$(1)\ a^ma^n=a^{m+n}$  $(2)\ (a^m)^n=a^{mn}$  $(3)\ (ab)^n=a^nb^n$


$(1)$ $a^0=1$이므로 $log_a1=0$,또 $a^1=a$이므로 $log_aa=1$

$(2)$ $a^{x+y}=a^xa^y$ 이므로 $a^x=M, a^y=N$이라고 하면 $a^{x+y}=MN$이다. 따라서 $x+y=log_aMN$이고 $x=log_aM, y=log_aN$이므로 $log_aMN=log_aM+log_aN$이다.

$(3)$ $\frac{a^x}{a^y}=a^{x-y}$이므로 $a^x=M, a^y=N$이라고 하면 $\frac{M}{N}=a^{x-y}$이다. 따라서 $x-y=log_a\frac{M}{N}$이고 $x=log_aM, y=log_aN$이므로 $log_a\frac{M}{N}=log_aM-log_aN$이다.

$(4)$ $a^x=M$이라고 하면 $(a^x)^r=M^r$이므로 $a^{xr}=M^r$이다. 따라서 $xr=log_aM^r$이다. 여기서 $x=log_aM$이므로  $log_aM\times r=log_aM^r$. 따라서  $log_aM^r=rlog_aM$이다.

$(5)$ $log_ab=x$라고 하면 $a^x=b$이므로 $log_ca^x=log_cb$이다. (4)에 따라 $xlog_ca=log_cb$이다. $a>0, a \neq 1$에 따라 $log_ca \neq 0$이므로 $x=\frac{log_cb}{log_ca}$이다.


## 자연로그의 밑 $e$

자연로그의 밑 $e$는 야코프 베르누이에 의해 다음의 극한 값으로 표현되며, 이는 가장 일반적으로 정의되고 있는 야코프베르누이의 방법이다.(https://ko.wikipedia.org/wiki/자연로그의_밑) 

$$e=\lim_{n -> \infty}(1+\frac{1}{n})^n \approx 2.71828...$$
위의 식은 은행에 돈을 저금한 후 원리합계(원금 + 이자)를 계산하는 과정에서 고안되었다. 즉 1년에 이자를 100% 준다고 할 때 1파운드를 맡기면 1년 후에는 2파운드가 된다. 하지만 이자를 6개월 단위로 계산할 경우 즉 6개월에 50% 이자를 받는 경우 1파운드의 돈은 6개월 후에는 1.5파운드가 되고 다시 6개월 후에는 $1.5\times 1.5=2.25$ 파운드가 된다. 다시 이자를 3개월에 한 번씩 25% 씩 받기로 한다면 1년 후 원리합계는 $1.25^4=2.441406$ 파운드가 된다. 이자를 1개월에 한 번씩 12번에 나누어 계산하면 원리합계는 

$$(1+\frac{1}{12})^{12} = 2.613035$$

가 되며 매일 365번에 걸쳐 계산하면 다음과 같다.

$$(1+\frac{1}{365})^{365} = 2.714567$$

만일 이자를 계산하는 횟수를 무한대로 한다면 이 값은 일정한 값에 수렴하는데 하는데 이 값이 자연로그의 밑이라고 불리는 $e$이다. 이 값을 그래프로 나타내보면 다음과 같다.

```{r,echo=FALSE}
ggplot()+
  stat_function(fun=function(x){(1+1/x)^x},col="blue",size=1)+
  annotate("segment",x=-Inf,xend=Inf,y=0,yend=0,arrow=arrow(length=unit(0.2,"cm")))+
  annotate("segment",x=0,xend=0,y=-Inf,yend=Inf,arrow=arrow(length=unit(0.2,"cm")))+
  annotate("text",x=0,y=0,label="italic(0)",size=6,hjust=1.5,vjust=1.5,parse=TRUE,family="Times")+
  annotate("text",x=12,y=exp(1)/2,label="italic(y==(1+frac(1,x))^x)",size=6,parse=TRUE,family="Times")+
  annotate("text",x=0,y=exp(1),label="italic(e)",size=6,hjust=1.5,parse=TRUE,family="Times")+
  annotate("text",x=0,y=Inf,label="italic(y)",size=6,hjust=1.5,vjust=1.5,parse=TRUE,family="Times")+
  annotate("text",x=Inf,y=0,label="italic(x)",size=6,hjust=1.5,vjust=2,parse=TRUE,family="Times")+
  annotate("segment",x=0,xend=Inf,y=exp(1),yend=exp(1),lty=2)+
  theme_classic()+ylim(c(-0.1,exp(1)+1))+xlim(c(0,20))+
  theme(axis.line=element_blank(),axis.text=element_blank(),axis.ticks = element_blank(),
        axis.title = element_blank())
```
로지스틱회귀분석이나 생존분석의 결과에서 나타나는 회귀계수는 바로 이 $e$를 밑으로 하는 지수로 해석해야 하므로 생존분석의 결과를 해석하는데 있어서 $e$값을 이해하는 것이 필수적이다.


## 최소한의 미분

### 미분 가능과 미분계수

$x$의 함수 $y=f(x)$가 있다고 하자. $x=a$ 근처에서 $x$의 변화량 $\Delta x$가 한없이 0에 가까워질 때 $y$의 변화량을  $x$의 변화량으로 나눈 값 즉 $\frac{\Delta y}{\Delta x}=\frac{f(a+\Delta x)-f(a)}{\Delta x}$가 어떤 일정한 값에 수렴할 때 $x=a$ 에서 미분가능이라고 한다. 또한 이 일정한 값을 함수 $f(x)$에서의 미분계수라고 하며 $f'(a)$라고 쓴다. 즉

\begin{equation}
f'(a)=\lim_{\Delta x->0}\frac{\Delta y}{\Delta x}=\lim_{\Delta x->0}\frac{f(a+\Delta x)-f(a)}{\Delta x}\\
(\#eq:eq1)
\end{equation}


식\@ref(eq:eq1)이 수렴 또는 일정한 값에 가까워진다는 것은 점 B를 점 A에 한없이 가깝게 접근시켰을 때  직선 $l$의 기울기가 일정값에 가까워짐을 의미한다.

```{r,echo=FALSE,warning=FALSE,message=FALSE}
library(ggplot2)
x=seq(0,3,length.out=50)
f=function(x){4*(x-1)^2+2}
y=f(x)
df=data.frame(x,y)

x1=c(1.5,2.5)
y1=f(x1)

ggplot(df,aes(x=x,y=y))+
  geom_line(size=1)+expand_limits(y=0)+
  theme_classic()+
  annotate("segment",x=x1[1],xend=x1[2],y=y1[1],yend=y1[2],col="blue")+
  annotate("segment",x=x1[1],xend=x1[2],y=y1[1],yend=y1[1],col="blue")+
  annotate("segment",x=x1[2],xend=x1[2],y=y1[1],yend=y1[2],col="blue")+
  annotate("text",x=sum(x1)/2,y=y1[1],label=expression(italic(Delta~"x")),vjust=1.1)+
  annotate("text",x=x1[2],y=sum(y1)/2,label=expression(italic(Delta~"y")),hjust=-0.1)+
  scale_x_continuous(breaks=x1,labels=c(expression(italic("a")),expression(italic("a" + Delta~"x"))))+
  scale_y_continuous(breaks=y1,labels=c(expression(italic("f(a)")),expression(italic("f(a" + Delta~"x)"))))+
  annotate("segment",x=x1[1],xend=x1[1],y=y1[1],yend=-Inf,lty=2)+
  annotate("segment",x=x1[2],xend=x1[2],y=y1[1],yend=-Inf,lty=2)+
  annotate("segment",x=-Inf,xend=x1[1],y=y1[1],yend=y1[1],lty=2)+
  annotate("segment",x=-Inf,xend=x1[2],y=y1[2],yend=y1[2],lty=2)+
  annotate("text",x=2.6,y=16,label=expression(italic(y==f(x))))+
  annotate("text",x=x1[1],y=y1[1],label="A",vjust=-1)+
  annotate("text",x=x1[2],y=y1[2],label="B",vjust=-1)+
  annotate("point",x=x1[1],y=y1[1],size=2,col="blue")+
  annotate("point",x=x1[2],y=y1[2],size=2,col="blue")+
  annotate("text",x=sum(x1)/2,y=sum(y1)/2,label="italic(slope == frac(Delta~'y',Delta~'x'))",parse=TRUE,hjust=1.2,vjust=0.1)
```
 
또한 앞의 식\@ref(eq:eq1) 이 일정한 값에 수렴할 때는 함수 $f(x)$의 그래프가 $x=a$에서 직선상태가 되며 AB를 지나가는 직선 $l$은 그 직선상태와 일치한다. 이 때의 직선 $l$은 $y=f(x)$그래프의 $x=a$에서의 접선이라고 생각한다. 즉 점 $A(a,f(a))$를 지나고 기울기가 $f'(a)$ 인  직선이 접선이라고 생각한다.`

```{r,echo=FALSE,warning=FALSE,message=FALSE}
x2=c(1.5)
y2=f(x2)
f1<-function(x){8*x-8}
slope=f1(x2)
intercept=slope*(-x2)+f(x2)

ggplot(df,aes(x=x,y=y))+
  geom_line(size=1)+expand_limits(y=0)+
  theme_classic()+
  geom_abline(slope=slope,intercept=intercept,col="blue")+
  scale_x_continuous(breaks=x2,label=expression(italic("a")))+
  scale_y_continuous(breaks=y2,label=expression(italic("f(a)")))+
  annotate("segment",x=x2,xend=x2,y=y2,yend=-Inf,lty=2)+
  annotate("segment",x=-Inf,xend=x2,y=y2,yend=y2,lty=2)+
  annotate("text",x=2.6,y=16,label=expression(italic(y==f(x))))+
  annotate("text",x=x2,y=y2,label=expression(italic("slope = f '(a)")),hjust=-0.2,col="blue")

```
또한 $y$축 위를 이동하는 점 $P$의 위치가 시간 $x$의 함수로써 $y=f(x)$로 표현될 때 $\frac{\Delta y}{\Delta x}$를 시각 $a$와 $a+\Delta x$사이의 평균적인 빠르기, $f'(a)$를 $x=a$에서의 속도라고 생각한다.


### 도함수와 기본함수의 도함수

함수 $f(x)$의 정의역 안에 있는 임의의 $x$에 미분계수 $f'(x)$를 대응시키는 함수를 함수 $f(x)$의 도함수라고 하고 $f'(x),y',\frac{dy}{dx},\frac{d}{dx}y$ 등으로 쓴다. 즉

$$f'(x)=\frac{dy}{dx}=\lim_{\Delta x->0}\frac{\Delta y}{\Delta x}=\lim_{\Delta x->0}\frac{f(x+\Delta x)-f(x)}{\Delta x}$$

#### $\Delta x, \Delta y, dx, dy$의 관계

$\frac{\Delta y}{\Delta x}$는 "델타 $x$분의 델타 $y$"라고 읽으며 $\Delta y :\Delta x$의 비를 의미한다. 한편 $\frac{dy}{dx}$ 는 "디$y$디$x$"라고 읽으며 $\Delta x$를 한없이 0에 가깝게 했을때 $\Delta y :\Delta x$라는 비의 값의 극한값을 나타낸다. 

```{r,echo=FALSE,message=FALSE,warning=FALSE}
x3=c(1.7)
y3=slope*x3+intercept

ggplot(df,aes(x=x,y=y))+
  geom_line(size=1)+expand_limits(y=0)+
  theme_classic()+
  annotate("segment",x=x1[1],xend=x1[2],y=y1[1],yend=y1[2])+
  annotate("segment",x=x1[1],xend=x1[2],y=y1[1],yend=y1[1])+
  annotate("segment",x=x1[2],xend=x1[2],y=y1[1],yend=y1[2])+
  annotate("text",x=sum(x1)/2,y=y1[1],label=expression(italic(Delta~"x")),vjust=1.1)+
  annotate("text",x=x1[2],y=sum(y1)/2,label=expression(italic(Delta~"y")),hjust=-0.1)+
  scale_x_continuous(breaks=x1,labels=c(expression(italic("a")),
                                        expression(italic("a" + Delta~"x"))),
                     limits=c(1,2.8))+
  scale_y_continuous(breaks=y1,labels=c(expression(italic("f(a)")),expression(italic("f(a" + Delta~"x)"))))+
  annotate("segment",x=x1[1],xend=x1[1],y=y1[1],yend=-Inf,lty=2)+
  annotate("segment",x=x1[2],xend=x1[2],y=y1[1],yend=-Inf,lty=2)+
  annotate("segment",x=-Inf,xend=x1[1],y=y1[1],yend=y1[1],lty=2)+
  annotate("segment",x=-Inf,xend=x1[2],y=y1[2],yend=y1[2],lty=2)+
  annotate("text",x=2.6,y=16,label=expression(italic(y==f(x))))+
  annotate("text",x=x1[1],y=y1[1],label="A",vjust=-1)+
  annotate("text",x=x1[2],y=y1[2],label="B",vjust=-1)+
  annotate("point",x=x1[1],y=y1[1],size=2)+
  annotate("point",x=x1[2],y=y1[2],size=2)+
  annotate("text",x=sum(x1)/2,y=sum(y1)/2,label="italic(slope == frac(Delta~'y',Delta~'x'))",parse=TRUE,hjust=1.2,vjust=0.1)+
  geom_abline(slope=slope,intercept=intercept,col="blue")+
  annotate("segment",x=x2,xend=x2,y=y2,yend=-Inf,lty=2)+
  annotate("segment",x=-Inf,xend=x2,y=y2,yend=y2,lty=2)+
  annotate("text",x=2.6,y=16,label=expression(italic(y==f(x))))+
  annotate("text",x=2.7,y=6,label="italic(frac(dy,dx))",hjust=-0.2,col="blue",parse=TRUE)+
  annotate("segment",x=x1[1],xend=x3,y=y1[1],yend=y3,col="blue")+
  annotate("segment",x=x1[1],xend=x3,y=y1[1],yend=y1[1],col="blue")+
  annotate("segment",x=x3,xend=x3,y=y1[1],yend=y3,col="blue")+
  annotate("text",x=sum(x1[1]+x3)/2,y=y1[1],label=expression(italic("dx")),vjust=1.1,col="blue")+
  annotate("text",x=x3,y=sum(y1[1]+y3)/2,label=expression(italic("dy")),hjust=-0.1,col="blue")
  
```

흔히 $\frac{dy}{dx}$는 그 자체로 하나의 기호이며 분수기호가 아니라고 간주되지만 분수의 의미도 충분히 가지고 있어 $\frac{dy}{dx}$를 분수처럼 다룰 때도 있다.

예) $y=x^2$ 일때  $\frac{dy}{dx}=2x$라고 쓸 수도 있고 $dy=2xdx$라고도 쓸수 있다.(수식은 아래 예 참조)

#### 도함수를 구해보자 

(1) 함수 $f(x)=x^2$의 도함수 $f'(x)$는  

\begin{align*}
f'(x)&=\lim_{\Delta x->0}\frac{\Delta y}{\Delta x}=\lim_{\Delta x->0}\frac{f(x+\Delta x)-f(x)}{\Delta x}\\
&=\lim_{\Delta x->0}\frac{(x+\Delta x)^2-(x)^2}{\Delta x}\\
&=\lim_{\Delta x->0}(2x+\Delta x)=2x
\end{align*}


(2) 함수 $f(x)=x^2+2x+10$의 도함수 $f'(x)$는  

\begin{align*}
f'(x)&=\lim_{\Delta x->0}\frac{[(x+\Delta x)^2+2 (x+\Delta x)+\cancel{10}]-[x^2+2 x+\cancel{10}]}{\Delta x}\\
&=\lim_{\Delta x->0}\frac{\cancel{x^2}+2x\Delta x+(\Delta x)^2+\cancel{2x}+2\Delta x-(\cancel{x^2}+\cancel{2 x})}{\Delta x}\\
&=\lim_{\Delta x->0}\frac{(2x+\Delta x+2)\cancel{\Delta x}}{\cancel{\Delta x}}\\
&=\lim_{\Delta x->0}(2x+\Delta x+2)=2x+2
\end{align*}


(3) 함수 $f(x) =\sqrt{3^2-x^2}$의 도함수 $f'(x)$는  

\begin{align*}
f'(x)&=\lim_{\Delta x->0}\frac{\sqrt{3^2-(x+\Delta x)^2}-\sqrt{3^2-x^2}}{\Delta x}\\
&=\lim_{\Delta x->0}\frac{(\sqrt{3^2-(x+\Delta x)^2}-\sqrt{3^2-x^2})(\sqrt{3^2-(x+\Delta x)^2}+\sqrt{3^2-x^2})}{\Delta x(\sqrt{3^2-(x+\Delta x)^2}+\sqrt{3^2-x^2})}\\
&=\lim_{\Delta x->0}\frac{-2x-\Delta x}{\Delta x(\sqrt{3^2-(x+\Delta x)^2}+\sqrt{3^2-x^2})}=\frac{-x}{\sqrt{3^2-x^2}}
\end{align*}


#### 기본함수의 도함수

도함수를 구하는 계산은 위의 예에서 보듯이 극한 계산이 기본이다. 하지만 일반적으로 쉬운 계산은 아니다. 그래서 실제로는 가장 기본적인 함수의 경우 극한계산으로 도함수를 구하고 그 밖의 함수의 경우 합성함수의 미분법이나 역함수의 미분법 등을 이용해 도함수를 구한다. 다음은 기본함수의 도함수이다. 아래에 나오는 기호 중  $e=\lim_{n->\infty}(1+\frac{1}{n})^n=2.71828...$는 오일러 상수이며 $ln$는 오일러 상수 $e$를 밑으로 하는 자연로그($log_e$)이다. 이때 밑 e는 일반적으로 생략하며  10을 밑으로 하는 상용로그($log_{10}$)와의 혼동을 피하기 위해 $ln$으로 표기하였다. 


함수f(x)  | 도함수f'(x)
----------|------------
$c$($c$는 정수) | $0$
$x^n$  ($n$은 실수)       | $nx^{n-1}$
$e^x$  | $e^x$
$a^x$  | $a^xlna$ 
$lnx$ | $\frac{1}{x}$
$log_aX$ | $\frac{1}{xlna}$

### 도함수의 사칙연산

두 함수 $f(x),g(x)$가 어떤 구간에서 미분가능하다면 그 구간에서 다음과 같은 계산이 가능하다. 


$(1)\ \{f(x) \pm g(x)\}'=f'(x) \pm g'(x)$

$(2)\ \{kf(x)\}'=kf'(x)$  단, k는 상수

$(3)\ \{f(x)g(x)\}'=f'(x)g(x)+f(x)g'(x)$

$(4)\ \{\frac{f(x)}{g(x)}\}'=\frac{f'(x)g(x)-f(x)g'(x)}{\{g(x)\}^2}$

특히 $\{\frac{1}{g(x)}\}'=\frac{-g'(x)}{\{g(x)\}^2}$


####  예제 

사칙연산으로 구성된 함수의 도함수는 위의 도함수 공식을 이용하면 쉽게 구할 수 있다. 위의 (1),(2)를 이용하면 다음의 계산이 가능하다.

\begin{align*}
(x^4-2x^3+3x^2-4x+5)'&=(x^4)'-(2x^3)'+(3x^2)'-(4x)'+(5)'\\
&=(x^4)'-2(x^3)'+3(x^2)'-4(x)'+(5)'\\
&=4x^3-6x^2+6x-4
\end{align*}

#### 간소화시킨 공식

(1)-(4)는 도함수를 구할 때 자주 사용되는데 $f(x)$나 $g(x)$ 같은 기호를 사용한 탓에 복잡하게 느껴진다. 그러므로 공식을 외울 때는 $f(x)$나 $g(x)$를 사용하지 않고 다음과 같이 간소화시키면 알아보기 쉽다.

$(1) (u\pm v)'=u'\pm v'$  $(2)(ku)'=ku'$

$(3) (uv)'=u'v+uv'$  $(4)(\frac{u}{v})'=\frac{u'v-uv'}{v^2}$  $(\frac{1}{v})'=\frac{-v}{v^2}$


#### 왜 그렇게 될까?

도함수의 정의 $f'(x)=\lim_{\Delta x->0} \frac{f(x+\Delta x)-f(x)}{\Delta x}$를 이용하여 중명하는데 여기서는 직관적으로 이해하기 어려운 (3),(4)를 증명해보겠다.

(3) $F(x) =f(x)g(x)$라고 하자.

\begin{align*}
F'(x)&=\lim_{\Delta x->0}\frac{F(x+\Delta x)-F(x)}{\Delta x}=\frac{f(x+\Delta x)g(x+\Delta x)-f(x)g(x)}{\Delta x}\\
&=\lim_{\Delta x->0}\frac{f(x+\Delta x)g(x+\Delta x)-f(x)g(x+\Delta x)+f(x)g(x+\Delta x)-f(x)g(x)}{\Delta x}\\
&=\lim_{\Delta x->0}\frac{\{f(x+\Delta x)-f(x)\}g(x+\Delta x)+\{g(x+\Delta x)-g(x)\}f(x)}{\Delta x}\\
&=f'(x)g(x)+f(x)g'(x)
\end{align*}

두 번 째 줄의 식의 분자 부분에서 원래 없었던 $f(x)g(x+\Delta x)$를 더하고 빼서 식을 정리하였다.

(4) 먼저 특수한 경우를 증명한다. 이를 위해 $F(x)=\frac{1}{g(x)}$라고 하자.

\begin{align*}
F'(x)&=\lim_{\Delta x->0}\frac{F(x+\Delta x)-F(x)}{\Delta x}\\
&=\lim_{\Delta x->0}\frac{\frac{1}{g(x+\Delta x)}-\frac{1}{g(x)}}{\Delta x}\\
&=\lim_{\Delta x->0}\frac{g(x)-g(x-\Delta x)}{\Delta xg(x+\Delta x)g(x)}\\
&=\lim_{\Delta x->0}-\frac{g(x+\Delta x)-g(x)}{\Delta x}\times\frac{1}{g(x+\Delta x)g(x)}\\
&=\frac{-g'(x)}{\{g(x)\}^2}
\end{align*}

다음으로 $F(x)=\frac{f(x)}{g(x)}$를 생각해보자.  $\frac{f(x)}{g(x)}=f(x)\times \frac{1}{g(x)}$이므로

\begin{align*}
\{\frac{f(x)}{g(x)}\}'&=\{f(x)\times \frac{1}{g(x)}\}'\\
&=f'(x)\frac{1}{g(x)}+f(x)\{\frac{-g(x)}{\{g(x)\}^2}\} \\
&=\frac{f'(x)g(x)-f(x)g'(x)}{\{g(x)\}^2}
\end{align*}


#### 예제: 도함수의 공식을 사용해보자 

(1) $(x^2-3x+5)(2x+3)$의 도함수를 구한다. $\leftarrow (uv)'=u'v+uv'$을 이용한다.

\begin{align*}
\{(x^2-3x+5)(2x+3)\}'&=(x^2-3x+5)'(2x+3)+(x^2-3x+5)(2x+3)'\\
&=(2x-3)(2x+3)+(x2-3x+5)\times 2 \\
&=6x^2-6x+1
\end{align*}

(2) $\frac{2x+3}{x^2-1}$의 도함수를 구한다. $\leftarrow (\frac{u}{v})'=\frac{u'v-uv'}{v^2}$을 이용한다.

\begin{align*}
\{\frac{2x+3}{x^2-1}\}'&=\frac{(2x+3)'(x^2-1)-(2x+3)(x^2-1)'}{(x^2+1)^2}\\
&=\frac{2(x^2-1)-(2x+3)\times 2x}{(x^2+1)^2}\\
&=\frac{-2x^2-6x-2}{(x^2+1)^2}\\
\end{align*}

### 합성함수의 미분

$y=f(u)$가 $u$에 대해 미분 가능하고 $u=g(x)$가 $x$에 대해 미분 가능하면 함성함수 $y=f(g(x))$는 x에 대해 미분 가능하며 그 도함수는 다음과 같다.

$$\frac{dy}{dx}=\frac{dy}{du}\frac{du}{dy}$$

#### 해설

$y=(3x+5)^2$과 같은 함수는 합성함수로 볼 수 있다. $u=3x+5$이라고 하면 $y$는 $u$의 함수이며 $y=f(u)=u^2$이고 $u$는 $x$의 함수이고 $u=g(x)=3x+5$이다. 즉,

$$y=f(u)=u^2=(g(x))^2=(3x+5)^2$$
이며 이 때 $y$를 합성함수라고 할 수 있다. 이를 좀 더 일반적으로 나타내면 $y=f(g(x))$가 된다. 

예를 들어 $y=(3x+5)^2$를 $x$에 대해 미분하려면 먼저 우측의 식을 전개해서 미분하는 방법이 있다. 

$$\frac{dy}{dx}=\{(3x+5)^2\}'=(9x^2+30x+25)'=18x+30=6(3x+5)$$
하지만 합성함수의 미분법을 쓰면 훨씬 간단해진다. y를 u에 대해 미분한 것에  $u$를 $x$에 대해 미분한 것을 곱하면 된다.

$$\frac{dy}{dx}=\frac{dy}{du}\frac{du}{dx}=2(3x+5)^1\times(3x+5)'=6(3x+5)$$
전개해서 미분한 결과와 합성함수의 미분으로 풀이한 결과는 같다. 물론 합성함수의 미분이 훨씬 간단하다. $y=(5x+3)^{100}$의 예를 보자. 이 경우 식의 우측을 전개하여 계산하는 것은 매우 어려울 것이다. 하지만 합성함수의 미분을 이용하면 간단해진다.

$$\{(5x+3)^{100}\}'=100(5x+3)^{99}\times (5x+3)'=500(5x+3)^{99}$$
또한 사칙연산 중 하나인 $\frac{1}{g(x)}=\{g(x)\}^{-1}$의 미분도 합성함수의 미분으로 풀 수 있다.

$$\{\frac{1}{g(x)}\}'=\{g(x)^{-1}\}'=-1\times g(x)^{-2}\times g'(x)=\frac{-g'(x)}{\{g(x)\}^2}$$

### 역함수의 미분

함수 $y=f(x)$가 미분 가능하고 $f'(x)>0$ 또는 $f'(x)<0$ 일 때 역함수 $x=g(y)$는 미분 가능한 함수이고 다음의 관계가 성립한다.

$$\frac{dx}{dy}=\frac{1}{\{\frac{dy}{dx}\}}$$

#### 해설 : 역함수란? 

함수 $y=f(x)$가 있을때 $y$의 각각의 값에 대하여 대응하는 $x$의 값이 하나 밖에 없을 경우 그 역인 함수 $x=g(y)$를 $y=f(x)$의 역함수라고 한다. 예를 들어 $y=\frac{1}{2}x+1$의 역함수는 $x=2(y-1)$이다. 

```{r,echo=FALSE,warning=FALSE}
library(ggplot2)

slope=0.5
intercept=1
x=2
y=slope*x+intercept

ggplot()+geom_abline(slope=slope,intercept=intercept,col="blue",size=1)+
  scale_x_continuous(breaks=x,label="x",limits = c(-1,5))+
  scale_y_continuous(breaks=y,label="y",limits = c(-0.5,5))+
  annotate("segment",x=x,xend=x,y=0,yend=y,
           arrow=arrow(ends="first",type="closed",angle=10,length=unit(0.1,"inches")))+
  annotate("segment",x=0,xend=x,y=y,yend=y,
           arrow=arrow(ends="first",type="closed",angle=10,length=unit(0.1,"inches")))+
  annotate("text",x=x,y=0,label="x",vjust=1.4)+
  annotate("text",x=0,y=y,label="y",hjust=1.4)+
  annotate("text",x=x,y=y/2,label=expression(italic("x=2y-2")),hjust=-0.5,parse=TRUE,family="Times",size=5)+
  annotate("text",x=x/2,y=y,label=expression(italic("y=0.5x+1")),vjust=-1,parse=TRUE,family="Times",size=5)+
   annotate("text",x=x,y=2*y,label=expression(italic("y=0.5x+1 <=> x=2y-2")),parse=TRUE,family="Times",size=5)+
  coord_equal()+
  theme_classic()+
  geom_hline(yintercept=0)+
  geom_vline(xintercept=0)+
  annotate("text",x=0,y=0,label="0",vjust=1.4,hjust=1.4)+
  theme(axis.line=element_blank(),axis.text=element_blank(),axis.ticks = element_blank(),
        axis.title = element_blank())
```

#### 예제

$x$의 자연로그 $lnx$의 도함수는 $\frac{d(lnx)}{dy}=\frac{1}{x}$ 이다. 이를 이용하여  $y=a^x(a>0)$을 미분하라.

$y=a^x(a>0)$의 양변을 자연로그를 취하면 $lny=xlna$가 되고 양변을 미분하면 $\frac{1}{y}=\frac{dx}{dy}lna$가 된다. 양변에 $lna$로 나누고 좌우를 바꾸면 $\frac{dy}{dx}=\frac{1}{ylna}$가 된다. 따라서 역함수의 미분법에 따라

$$\frac{dy}{dx}=\frac{1}{\frac{dx}{dy}}=ylna=a^xlna$$


## 실전예제

### 준비운동

다음을 함수를 $\beta$ 에 대하여 미분하라

$$log(2e^\beta+2)$$

풀이 : 위의 함수는 $\beta$를 변수로 하는 합성함수로 로그와 자연로그의 밑 $e$가 포함되어 있다. $e\approx 2.71828...$로 상수이다.  즉 위 함수의 형태는 $x$ 를 변수로 하는 $log(2\times 3^x+2)$ 와  형태가 같다. 차이점은 $e$라는 상수가 쓰였고 $x$대신 $\beta$를 변수이름으로 사용했을 뿐이다.  함성함수의 미분법에 따라  먼저 $log(2e^\beta+2)$를 미분하고 $2e^\beta+2$를 미분하여 곱하면 된다. $(log(x))'=\frac{1}{x}$ 이므로


$$\{log(2e^\beta+2)\}'=\frac{(2e^\beta+2)'}{2e^\beta+2}=\frac{2e^\beta}{2e^\beta+2}=\frac{e^\beta}{e^\beta+1}$$


### 실전예제

이번 장에서 배운 수학지식을 바탕으로 4.7절에서 다룰 아주 간단한 콕스모형의 가능도함수를 다루어보자. 자세한 내용은 4.7절을 참조하기로 하고 여기서는 가능도함수가 최대값이 되는 값을 구해본다. 4.7절의 가능도함수는 다음과 같다.


$$L(\beta)=\frac{e^\beta}{(2e^{\beta}+2)\times (e^{\beta}+2)}$$

이 가능도함수를 로그를 취하면 로그가능도 함수가 된다. 로그를 취하면 곱하기는 더하기가 되고 나누기는 뺄셈이 된다.

\begin{align*}
l(\beta)&=log(\frac{e^\beta}{(2e^{\beta}+2)\times (e^{\beta}+2)}) \\
&=log(e^\beta)-log(2e^\beta+2)-log(e^\beta+2)
\end{align*}

이 로그가능도 함수를 그래프로 나타내보면 다음과 같다. 

```{r}
pl <- function(beta) {
  psi <- exp(beta)
  result <- log(psi) - log(2*psi + 2) - log(psi + 2) 
  result
}

beta=seq(-2,2,length.out=100)
plot(pl(beta) ~ beta, type="l", xlab="beta", ylab="log partial likelihood",
     cex.axis=1.5, cex.lab=1.5, lwd=2, col="black")
```

로그가능도함수를 미분한 함수가 스코어 함수이다. 스코어함수 값은 로그가능도함수 그래프의 기울기가 된다.

\begin{align*}
U(\beta)&=l'(\beta)=(log(e^\beta)-log(2e^\beta+2)-log(e^\beta+2))'\\
&=\frac{e^\beta}{e^\beta}-\frac{2e^\beta}{2e^\beta+2}-\frac{e^\beta}{e^\beta+2}\\
&=1-\frac{e^\beta}{e^\beta+1}-\frac{e^\beta}{e^\beta+2}
\end{align*}

스코어 함수를 그래프로 그려보면 다음과 같다.

```{r}
scoref=function(beta){    
   psi <- exp(beta)
   result=1-psi/(psi+1)-psi/(psi+2)
   result
}

plot(scoref(beta) ~ beta, type="l", xlab="beta", ylab="score function",
     cex.axis=1.5, cex.lab=1.5, lwd=2, col="black")
```

이 값은 스코어함수의 값이 0이 되는 $\beta$의 값과  같다. 이 값은 uniroot함수로 구할 수 있다.

```{r}
result1 <- uniroot(f = scoref, interval=c(-5,5),tol = .Machine$double.eps)
result1$root
```

이제 여러분은 $e$를 포함한 방정식의 로그변환, 미분 등을 두려워하지 않아도 된다. 콕스 비례모형에 대한 보다 자세한 내용은 제 4장을 참조하기로 하고 다음 장부터는 본격적으로 생존분석에 대해 다루어보기로 한다.
