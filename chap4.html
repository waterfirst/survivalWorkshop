<!DOCTYPE html>
<html lang="en"><head>
<script src="chap4_files/libs/clipboard/clipboard.min.js"></script>
<script src="chap4_files/libs/quarto-html/tabby.min.js"></script>
<script src="chap4_files/libs/quarto-html/popper.min.js"></script>
<script src="chap4_files/libs/quarto-html/tippy.umd.min.js"></script>
<link href="chap4_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="chap4_files/libs/quarto-html/quarto-html.min.css" rel="stylesheet" data-mode="light">
<link href="chap4_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.1.189">

  <meta name="author" content="문건웅">
  <title>콕스비례위험모형</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="chap4_files/libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="chap4_files/libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="chap4_files/libs/revealjs/dist/theme/quarto.css" id="theme">
  <link href="chap4_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="chap4_files/libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="chap4_files/libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="chap4_files/libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">

  .callout {
    margin-top: 1em;
    margin-bottom: 1em;  
    border-radius: .25rem;
  }

  .callout.callout-style-simple { 
    padding: 0em 0.5em;
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
    display: flex;
  }

  .callout.callout-style-default {
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
  }

  .callout .callout-body-container {
    flex-grow: 1;
  }

  .callout.callout-style-simple .callout-body {
    font-size: 1rem;
    font-weight: 400;
  }

  .callout.callout-style-default .callout-body {
    font-size: 0.9rem;
    font-weight: 400;
  }

  .callout.callout-captioned.callout-style-simple .callout-body {
    margin-top: 0.2em;
  }

  .callout:not(.callout-captioned) .callout-body {
      display: flex;
  }

  .callout:not(.no-icon).callout-captioned.callout-style-simple .callout-content {
    padding-left: 1.6em;
  }

  .callout.callout-captioned .callout-header {
    padding-top: 0.2em;
    margin-bottom: -0.2em;
  }

  .callout.callout-captioned .callout-caption  p {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }
    
  .callout.callout-captioned.callout-style-simple .callout-content  p {
    margin-top: 0;
  }

  .callout.callout-captioned.callout-style-default .callout-content  p {
    margin-top: 0.7em;
  }

  .callout.callout-style-simple div.callout-caption {
    border-bottom: none;
    font-size: .9rem;
    font-weight: 600;
    opacity: 75%;
  }

  .callout.callout-style-default  div.callout-caption {
    border-bottom: none;
    font-weight: 600;
    opacity: 85%;
    font-size: 0.9rem;
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-default div.callout-content {
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-simple .callout-icon::before {
    height: 1rem;
    width: 1rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 1rem 1rem;
  }

  .callout.callout-style-default .callout-icon::before {
    height: 0.9rem;
    width: 0.9rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 0.9rem 0.9rem;
  }

  .callout-caption {
    display: flex
  }
    
  .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  .callout.no-icon::before {
    display: none !important;
  }

  .callout.callout-captioned .callout-body > .callout-content > :last-child {
    margin-bottom: 0.5rem;
  }

  .callout.callout-captioned .callout-icon::before {
    margin-top: .5rem;
    padding-right: .5rem;
  }

  .callout:not(.callout-captioned) .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  /* Callout Types */

  div.callout-note {
    border-left-color: #4582ec !important;
  }

  div.callout-note .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEU0lEQVRYCcVXTWhcVRQ+586kSUMMxkyaElstCto2SIhitS5Ek8xUKV2poatCcVHtUlFQk8mbaaziwpWgglJwVaquitBOfhQXFlqlzSJpFSpIYyXNjBNiTCck7x2/8/LeNDOZxDuEkgOXe++553zfefee+/OYLOXFk3+1LLrRdiO81yNqZ6K9cG0P3MeFaMIQjXssE8Z1JzLO9ls20MBZX7oG8w9GxB0goaPrW5aNMp1yOZIa7Wv6o2ykpLtmAPs/vrG14Z+6d4jpbSKuhdcSyq9wGMPXjonwmESXrriLzFGOdDBLB8Y6MNYBu0dRokSygMA/mrun8MGFN3behm6VVAwg4WR3i6FvYK1T7MHo9BK7ydH+1uurECoouk5MPRyVSBrBHMYwVobG2aOXM07sWrn5qgB60rc6mcwIDJtQrnrEr44kmy+UO9r0u9O5/YbkS9juQckLed3DyW2XV/qWBBB3ptvI8EUY3I9p/67OW+g967TNr3Sotn3IuVlfMLVnsBwH4fsnebJvyGm5GeIUA3jljERmrv49SizPYuq+z7c2H/jlGC+Ghhupn/hcapqmcudB9jwJ/3jvnvu6vu5lVzF1fXyZuZZ7U8nRmVzytvT+H3kilYvH09mLWrQdwFSsFEsxFVs5fK7A0g8gMZjbif4ACpKbjv7gNGaD8bUrlk8x+KRflttr22JEMRUbTUwwDQScyzPgedQHZT0xnx7ujw2jfVfExwYHwOsDTjLdJ2ebmeQIlJ7neo41s/DrsL3kl+W2lWvAga0tR3zueGr6GL78M3ifH0rGXrBC2aAR8uYcIA5gwV8zIE8onoh8u0Fca/ciF7j1uOzEnqcIm59sEXoGc0+z6+H45V1CvAvHcD7THztu669cnp+L0okAeIc6zjbM/24LgGM1gZk7jnRu1aQWoU9sfUOuhrmtaPIO3YY1KLLWZaEO5TKUbMY5zx8W9UJ6elpLwKXbsaZ4EFl7B4bMtDv0iRipKoDQT2sNQI9b1utXFdYisi+wzZ/ri/1m7QfDgEuvgUUEIJPq3DhX/5DWNqIXDOweC2wvIR90Oq3lDpdMIgD2r0dXvGdsEW5H6x6HLRJYU7C69VefO1x8Gde1ZFSJLfWS1jbCnhtOPxmpfv2LXOA2Xk2tvnwKKPFuZ/oRmwBwqRQDcKNeVQkYcOjtWVBuM/JuYw5b6isojIkYxyYAFn5K7ZBF10fea52y8QltAg6jnMqNHFBmGkQ1j+U43HMi2xMar1Nv0zGsf1s8nUsmUtPOOrbFIR8bHFDMB5zL13Gmr/kGlCkUzedTzzmzsaJXhYawnA3UmARpiYj5ooJZiUoxFRtK3X6pgNPv+IZVPcnwbOl6f+aBaO1CNvPW9n9LmCp01nuSaTRF2YxHqZ8DYQT6WsXT+RD6eUztwYLZ8rM+rcPxamv1VQzFUkzFXvkiVrySGQgJNvXHJAxiU3/NwiC03rSf05VBaPtu/Z7/B8Yn/w7eguloAAAAAElFTkSuQmCC');
  }

  div.callout-note.callout-style-default .callout-caption {
    background-color: #dae6fb
  }

  div.callout-important {
    border-left-color: #d9534f !important;
  }

  div.callout-important .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEKklEQVRYCcVXTWhcVRS+575MJym48A+hSRFr00ySRQhURRfd2HYjk2SSTokuBCkU2o0LoSKKraKIBTcuFCoidGFD08nkBzdREbpQ1EDNIv8qSGMFUboImMSZd4/f9zJv8ibJMC8xJQfO3HPPPef7zrvvvnvviIkpC9nsw0UttFunbUhpFzFtarSd6WJkStVMw5xyVqYTvkwfzuf/5FgtkVoB0729j1rjXwThS7Vio+Mo6DNnvLfahoZ+i/o32lULuJ3NNiz7q6+pyAUkJaFF6JwaM2lUJlV0MlnQn5aTRbEu0SEqHUa0A4AdiGuB1kFXRfVyg5d87+Dg4DL6m2TLAub60ilj7A1Ec4odSAc8X95sHh7+ZRPCFo6Fnp7HfU/fBng/hi10CjCnWnJjsxvDNxWw0NfV6Rv5GgP3I3jGWXumdTD/3cbEOP2ZbOZp69yniG3FQ9z1jD7bnBu9Fc2tKGC2q+uAJOQHBDRiZX1x36o7fWBs7J9ownbtO+n0/qWkvW7UPIfc37WgT6ZGR++EOJyeQDSb9UB+DZ1G6DdLDzyS+b/kBCYGsYgJbSQHuThGKRcw5xdeQf8YdNHsc6ePXrlSYMBuSIAFTGAtQo+VuALo4BX83N190NWZWbynBjhOHsmNfFWLeL6v+ynsA58zDvvAC8j5PkbOcXCMg2PZFk3q8MjI7WAG/Dp9AwP7jdGBOOQkAvlFUB+irtm16I1Zw9YBcpGTGXYmk3kQIC/Cds55l+iMI3jqhjAuaoe+am2Jw5GT3Nbz3CkE12NavmzN5+erJW7046n/CH1RO/RVa8lBLozXk9uqykkGAyRXLWlLv5jyp4RFsG5vGVzpDLnIjTWgnRy2Rr+tDKvRc7Y8AyZq10jj8DqXdnIRNtFZb+t/ZRtXcDiVnzpqx8mPcDWxgARUqx0W1QB9MeUZiNrV4qP+Ehc+BpNgATsTX8ozYKL2NtFYAHc84fG7ndxUPr+AR/iQSns7uSUufAymwDOb2+NjK27lEFocm/EE2WpyIy/Hi66MWuMKJn8RvxIcj87IM5Vh9663ziW36kR0HNenXuxmfaD8JC7tfKbrhFr7LiZCrMjrzTeGx+PmkosrkNzW94ObzwocJ7A1HokLolY+AvkTiD/q1H0cN48c5EL8Crkttsa/AXQVDmutfyku0E7jShx49XqV3MFK8IryDhYVbj7Sj2P2eBxwcXoe8T8idsKKPRcnZw1b+slFTubwUwhktrfnAt7J++jwQtLZcm3sr9LQrjRzz6cfMv9aLvgmnAGvpoaGLxM4mAEaLV7iAzQ3oU0IvD5x9ix3yF2RAAuYAOO2f7PEFWCXZ4C9Pb2UsgDeVnFSpbFK7/IWu7TPTvBqzbGdCHOJQSxiEjt6IyZmxQyEJHv6xyQsYk//moVFsN2zP6fRImjfq7/n/wFDguUQFNEwugAAAABJRU5ErkJggg==');
  }

  div.callout-important.callout-style-default .callout-caption {
    background-color: #f7dddc
  }

  div.callout-warning {
    border-left-color: #f0ad4e !important;
  }

  div.callout-warning .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAETklEQVRYCeVWW2gcVRg+58yaTUnizqbipZeX4uWhBEniBaoUX1Ioze52t7sRq6APio9V9MEaoWlVsFasRq0gltaAPuxms8lu0gcviE/FFOstVbSIxgcv6SU7EZqmdc7v9+9mJtNks51NTUH84ed889/PP+cmxP+d5FIbMJmNbpREu4WUkiTtCicKny0l1pIKmBzovF2S+hIJHX8iEu3hZJ5lNZGqyRrGSIQpq15AzF28jgpeY6yk6GVdrfFqdrD6Iw+QlB8g0YS2g7dyQmXM/IDhBhT0UCiRf59lfqmmDvzRt6kByV/m4JjtzuaujMUM2c5Z2d6JdKrRb3K2q6mA+oYVz8JnDdKPmmNthzkAk/lN63sYPgevrguc72aZX/L9C6x09GYyxBgCX4NlvyGUHOKELlm5rXeR1kchuChJt4SSwyddZRXgvwMGvYo4QSlk3/zkHD8UHxwVJA6zjZZqP8v8kK8OWLnIZtLyCAJagYC4rTGW/9Pqj92N/c+LUaAj27movwbi19tk/whRCIE7Q9vyI6yvRpftAKVTdUjOW40X3h5OXsKCdmFcx0xlLJoSuQngnrJe7Kcjm4OMq9FlC7CMmScQANuNvjfP3PjGXDBaUQmbp296S5L4DrpbrHN1T87ZVEZVCzg1FF0Ft+dKrlLukI+/c9ENo+TvlTDbYFvuKPtQ9+l052rXrgKoWkDAFnvh0wTOmYn8R5f4k/jN/fZiCM1tQx9jQQ4ANhqG4hiL0qIFTGViG9DKB7GYzgubnpofgYRwO+DFjh0Zin2m4b/97EDkXkc+f6xYAPX0KK2I/7fUQuwzuwo/L3AkcjugPNixC8cHf0FyPjWlItmLxWw4Ou9YsQCr5fijMGoD/zpdRy95HRysyXA74MWOnscpO4j2y3HAVisw85hX5+AFBRSHt4ShfLFkIMXTqyKFc46xdzQM6XbAi702a7sy04J0+feReMFKp5q9esYLCqAZYw/k14E/xcLLsFElaornTuJB0svMuJINy8xkIYuL+xPAlWRceH6+HX7THJ0djLUom46zREu7tTkxwmf/FdOZ/sh6Q8qvEAiHpm4PJ4a/doJe0gH1t+aHRgCzOvBvJedEK5OFE5jpm4AGP2a8Dxe3gGJ/pAutug9Gp6he92CsSsWBaEcxGx0FHytmIpuqGkOpldqNYQK8cSoXvd+xLxXADw0kf6UkJNFtdo5MOgaLjiQOQHcn+A6h5NuL2s0qsC2LOM75PcF3yr5STuBSAcGG+meA14K/CI21HcS4LBT6tv0QAh8Dr5l93AhZzG5ZJ4VxAqdZUEl9z7WJ4aN+svMvwHHL21UKTd1mqvChH7/Za5xzXBBKrUcB0TQ+Ulgkfbi/H/YT5EptrGzsEK7tR1B7ln9BBwckYfMiuSqklSznIuoIIOM42MQO+QnduCoFCI0bpkzjCjddHPN/F+2Yu+sd9bKNpVwHhbS3LluK/0zgfwD0xYI5dXuzlQAAAABJRU5ErkJggg==');
  }

  div.callout-warning.callout-style-default .callout-caption {
    background-color: #fcefdc
  }

  div.callout-tip {
    border-left-color: #02b875 !important;
  }

  div.callout-tip .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAADr0lEQVRYCe1XTWgTQRj9ZjZV8a9SPIkKgj8I1bMHsUWrqYLVg4Ue6v9BwZOxSYsIerFao7UiUryIqJcqgtpimhbBXoSCVxUFe9CTiogUrUp2Pt+3aUI2u5vdNh4dmMzOzHvvezuz8xNFM0mjnbXaNu1MvFWRXkXEyE6aYOYJpdW4IXuA4r0fo8qqSMDBU0v1HJUgVieAXxzCsdE/YJTdFcVIZQNMyhruOMJKXYFoLfIfIvVIMWdsrd+Rpd86ZmyzzjJmLStqRn0v8lzkb4rVIXvnpScOJuAn2ACC65FkPzEdEy4TPWRLJ2h7z4cArXzzaOdKlbOvKKX25Wl00jSnrwVxAg3o4dRxhO13RBSdNvH0xSARv3adTXbBdTf64IWO2vH0LT+cv4GR1DJt+DUItaQogeBX/chhbTBxEiZ6gftlDNXTrvT7co4ub5A6gp9HIcHvzTa46OS5fBeP87Qm0fQkr4FsYgVQ7Qg+ZayaDg9jhg1GkWj8RG6lkeSacrrHgDaxdoBiZPg+NXV/KifMuB6//JmYH4CntVEHy/keA6x4h4CU5oFy8GzrBS18cLJMXcljAKB6INjWsRcuZBWVaS3GDrqB7rdapVIeA+isQ57Eev9eCqzqOa81CY05VLd6SamW2wA2H3SiTbnbSxmzfp7WtKZkqy4mdyAlGx7ennghYf8voqp9cLSgKdqNfa6RdRsAAkPwRuJZNbpByn+RrJi1RXTwdi8RQF6ymDwGMAtZ6TVE+4uoKh+MYkcLsT0Hk8eAienbiGdjJHZTpmNjlbFJNKDVAp2fJlYju6IreQxQ08UJDNYdoLSl6AadO+fFuCQqVMB1NJwPm69T04Wv5WhfcWyfXQB+wXRs1pt+nCknRa0LVzSA/2B+a9+zQJadb7IyyV24YAxKp2Jqs3emZTuNnKxsah+uabKbMk7CbTgJx/zIgQYErIeTKRQ9yD9wxVof5YolPHqaWo7TD6tJlh7jQnK5z2n3+fGdggIOx2kaa2YI9QWarc5Ce1ipNWMKeSG4DysFF52KBmTNMmn5HqCFkwy34rDg05gDwgH3bBi+sgFhN/e8QvRn8kbamCOhgrZ9GJhFDgfcMHzFb6BAtjKpFhzTjwv1KCVuxHvCbsSiEz4CANnj84cwHdFXAbAOJ4LTSAawGWFn5tDhLMYz6nWeU2wJfIhmIJBefcd/A5FWQWGgrWzyORZ3Q6HuV+Jf0Bj+BTX69fm1zWgK7By1YTXchFDORywnfQ7GpzOo6S+qECrsx2ifVQAAAABJRU5ErkJggg==');
  }

  div.callout-tip.callout-style-default .callout-caption {
    background-color: #ccf1e3
  }

  div.callout-caution {
    border-left-color: #fd7e14 !important;
  }

  div.callout-caution .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAACV0lEQVRYCdVWzWoUQRCuqp2ICBLJXgITZL1EfQDBW/bkzUMUD7klD+ATSHBEfAIfQO+iXsWDxJsHL96EHAwhgzlkg8nBg25XWb0zIb0zs9muYYWkoKeru+vn664fBqElyZNuyh167NXJ8Ut8McjbmEraKHkd7uAnAFku+VWdb3reSmRV8PKSLfZ0Gjn3a6Xlcq9YGb6tADjn+lUfTXtVmaZ1KwBIvFI11rRXlWlatwIAAv2asaa9mlB9wwygiDX26qaw1yYPzFXg2N1GgG0FMF8Oj+VIx7E/03lHx8UhvYyNZLN7BwSPgekXXLribw7w5/c8EF+DBK5idvDVYtEEwMeYefjjLAdEyQ3M9nfOkgnPTEkYU+sxMq0BxNR6jExrAI31H1rzvLEfRIdgcv1XEdj6QTQAS2wtstEALLG1yEZ3QhH6oDX7ExBSFEkFINXH98NTrme5IOaaA7kIfiu2L8A3qhH9zRbukdCqdsA98TdElyeMe5BI8Rs2xHRIsoTSSVFfCFCWGPn9XHb4cdobRIWABNf0add9jakDjQJpJ1bTXOJXnnRXHRf+dNL1ZV1MBRCXhMbaHqGI1JkKIL7+i8uffuP6wVQAzO7+qVEbF6NbS0LJureYcWXUUhH66nLR5rYmva+2tjRFtojkM2aD76HEGAD3tPtKM309FJg5j/K682ywcWJ3PASCcycH/22u+Bh7Aa0ehM2Fu4z0SAE81HF9RkB21c5bEn4Dzw+/qNOyXr3DCTQDMBOdhi4nAgiFDGCinIa2owCEChUwD8qzd03PG+qdW/4fDzjUMcE1ZpIAAAAASUVORK5CYII=');
  }

  div.callout-caution.callout-style-default .callout-caption {
    background-color: #ffe5d0
  }

  </style>
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="center">
  <h1 class="title">콕스비례위험모형</h1>
  <p class="author">문건웅</p>
</section>

<section id="내용" class="slide level2">
<h2>내용</h2>
<script type="text/x-mathjax-config">
MathJax.Hub.Register.StartupHook("TeX Jax Ready",function () {
  MathJax.Hub.Insert(MathJax.InputJax.TeX.Definitions.macros,{
    cancel: ["Extension","cancel"],
    bcancel: ["Extension","cancel"],
    xcancel: ["Extension","cancel"],
    cancelto: ["Extension","cancel"]
  });
});
</script>
<div class="columns">
<div class="column" style="width:70%;">
<ul>
<li>콕스PH모형에 적합시킨 여러 모형의 비교</li>
<li>콕스PH모형식</li>
<li>콕스PH모형의 강점</li>
<li>콕스PH모형에서 회귀계수의 추정</li>
<li>위험비의 계산</li>
<li>콕스PH모형을 이용한 보정된 생존곡선</li>
<li>콕스가능도</li>
<li>여러 개의 공변량이 있을 때 콕스부분가능도</li>
</ul>
</div><div class="column" style="width:30%;">
<p>Sir David Cox (1924-2022)</p>
<p><img data-src="images/sir-david-cox-2014.jpg"></p>
</div>
</div>
</section>
<section id="콕스ph모형에-적합시킨-여러-모형의-비교" class="slide level2" data-background="#43464B">
<h2>콕스PH모형에 적합시킨 여러 모형의 비교</h2>
</section>
<section id="콕스ph모형에-적합시킨-여러-모형의-비교-1" class="slide level2">
<h2>콕스PH모형에 적합시킨 여러 모형의 비교</h2>
<ul>
<li>anderson 데이터(autoReg 패키지)</li>
<li>백혈병 환자 42명</li>
<li>대조군(rx=1)과 치료군(rx=0)</li>
<li>재발(status=1)까지의 생존기간</li>
<li>성별(sex, 0: Female, 1:Male), 로그백혈구수(logWBC)</li>
</ul>
</section>
<section id="section" class="slide level2">
<h2></h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu">library</span>(autoReg)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="fu">library</span>(survival)</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="fu">library</span>(survminer)</span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="fu">library</span>(flextable)</span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="fu">library</span>(ftExtra)</span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="fu">library</span>(interpretCI)</span>
<span id="cb1-7"><a href="#cb1-7"></a></span>
<span id="cb1-8"><a href="#cb1-8"></a>anderson</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   time status sex logWBC rx
1    35      0   1   1.45  0
2    34      0   1   1.47  0
3    32      0   1   2.20  0
4    32      0   1   2.53  0
5    25      0   1   1.78  0
6    23      1   1   2.57  0
7    22      1   1   2.32  0
8    20      0   1   2.01  0
9    19      0   0   2.05  0
10   17      0   0   2.16  0
11   16      1   1   3.60  0
12   13      1   0   2.88  0
13   11      0   0   2.60  0
14   10      0   0   2.70  0
15   10      1   0   2.96  0
16    9      0   0   2.80  0
17    7      1   0   4.43  0
18    6      0   0   3.20  0
19    6      1   0   2.31  0
20    6      1   1   4.06  0
21    6      1   0   3.28  0
22   23      1   1   1.97  1
23   22      1   0   2.73  1
24   17      1   0   2.95  1
25   15      1   0   2.30  1
26   12      1   0   1.50  1
27   12      1   0   3.06  1
28   11      1   0   3.49  1
29   11      1   0   2.12  1
30    8      1   0   3.52  1
31    8      1   0   3.05  1
32    8      1   0   2.32  1
33    8      1   1   3.26  1
34    5      1   1   3.49  1
35    5      1   0   3.97  1
36    4      1   1   4.36  1
37    4      1   1   2.42  1
38    3      1   1   4.01  1
39    2      1   1   4.91  1
40    2      1   1   4.48  1
41    1      1   1   2.80  1
42    1      1   1   5.00  1</code></pre>
</div>
</div>
</section>
<section id="여러-모형의-비교" class="slide level2">
<h2>여러 모형의 비교</h2>
<div class="sourceCode" id="cb3" data-code-line-numbers="1|2|3|5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>fit1<span class="ot">=</span><span class="fu">coxph</span>(<span class="fu">Surv</span>(time,status)<span class="sc">~</span>rx, <span class="at">data=</span>anderson)</span>
<span id="cb3-2"><a href="#cb3-2"></a>fit2<span class="ot">=</span><span class="fu">coxph</span>(<span class="fu">Surv</span>(time,status)<span class="sc">~</span>rx<span class="sc">+</span>logWBC,<span class="at">data=</span>anderson)</span>
<span id="cb3-3"><a href="#cb3-3"></a>fit3<span class="ot">=</span><span class="fu">coxph</span>(<span class="fu">Surv</span>(time,status)<span class="sc">~</span>rx<span class="sc">*</span>logWBC,<span class="at">data=</span>anderson)</span>
<span id="cb3-4"><a href="#cb3-4"></a></span>
<span id="cb3-5"><a href="#cb3-5"></a><span class="fu">modelsSummaryTable</span>(<span class="fu">list</span>(fit1,fit2,fit3)) <span class="sc">%&gt;%</span> <span class="fu">highlight</span>(<span class="at">j=</span><span class="dv">7</span>,<span class="at">part=</span><span class="st">"all"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="fragment">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="chap4_files/figure-revealjs/unnamed-chunk-3-1.png" style="width:70.0%"></p>
</figure>
</div>
</div>
</div>
</div>
</section>
<section id="위험비hazard-ratio" class="slide level2">
<h2>위험비(Hazard Ratio)</h2>
<ul>
<li>회귀계수와 HR: 첫번째 모형의 rx에 대한 회귀계수는 1.572 <span class="math display">\[HR=e^{coef}=e^{1.572} \approx 4.817\]</span></li>
<li>R에서 자연로그의 역함수인 <span class="math inline">\(e^x\)</span>는 다음과 같이 계산한다.</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="fu">exp</span>(<span class="fl">1.572</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4.816271</code></pre>
</div>
</div>
</section>
<section id="회귀계수와-p-값" class="slide level2">
<h2>회귀계수와 p 값</h2>
<div class="sourceCode" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="fu">gaze</span>(fit3) <span class="sc">%&gt;%</span> <span class="fu">myft</span>() <span class="sc">%&gt;%</span> <span class="fu">highlight</span>(<span class="at">i=</span><span class="dv">1</span>,<span class="at">j=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

<img data-src="chap4_files/figure-revealjs/unnamed-chunk-5-1.png" style="width:70.0%" class="r-stretch quarto-figure-center"><div class="fragment">
<ul>
<li>z 통계량 (Wald통계량): 회귀계수/회귀계수의 표준오차</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="fl">2.375</span><span class="sc">/</span><span class="fl">1.705</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.392962</code></pre>
</div>
</div>
</div>
</section>
<section id="p-값" class="slide level2">
<h2>p 값</h2>
<ul>
<li>Wald 검정</li>
<li>귀무가설 <span class="math inline">\(H_0: coefficient=0\)</span></li>
<li>p값은 표준정규분포에서 z 통계량보다 더 극단적인 값을 가질 확률이다. 이를 표준정규분포표에서 확인해보면 다음과 같다.</li>
</ul>
<div class="sourceCode" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="fu">show_z_table</span>(<span class="at">z=</span><span class="fl">1.392962</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

<img data-src="chap4_files/figure-revealjs/unnamed-chunk-7-1.png" style="width:70.0%" class="r-stretch quarto-figure-center"></section>
<section id="section-1" class="slide level2">
<h2></h2>
<p>이 값을 표준정규분포곡선에서 확인하면 다음과 같다.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="fu">draw_n</span>(<span class="at">z=</span><span class="fl">1.392962</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="chap4_files/figure-revealjs/unnamed-chunk-8-1.png" style="width:70.0%" class="r-stretch quarto-figure-center"><p>양측검정이므로 p값은 0.164가 된다. 따라서 귀무가설 <span class="math inline">\(H_0\)</span>를 기각하기에는 근거가 부족하다.</p>
</section>
<section id="hr의-95-신뢰구간" class="slide level2">
<h2>HR의 95% 신뢰구간</h2>
<ul>
<li>회귀계수의 95% 신뢰구간 : <strong>회귀계수 <span class="math inline">\(\pm 1.96\times\)</span> 표준오차</strong>로 정해진다. 설명변수 rx의 경우 회귀계수는 2.375, 회귀계수의 표준오차는 1.705이므로 회귀계수의 95% 신뢰구간은</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="fl">2.37491</span><span class="sc">+</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">1</span>)<span class="sc">*</span><span class="fl">1.96</span><span class="sc">*</span><span class="fl">1.70547</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.9678112  5.7176312</code></pre>
</div>
</div>
<ul>
<li>HR의 95% 신뢰구간은 다음과 같이 계산된다.</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="fu">exp</span>(<span class="fl">2.37491</span><span class="sc">+</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">1</span>)<span class="sc">*</span><span class="fl">1.96</span><span class="sc">*</span><span class="fl">1.70547</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]   0.3799137 304.1835189</code></pre>
</div>
</div>
</section>
<section id="가능도비-검정" class="slide level2">
<h2>가능도비 검정</h2>
<div class="sourceCode" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="fu">gaze</span>(fit3) <span class="sc">%&gt;%</span> <span class="fu">myft</span>() <span class="sc">%&gt;%</span> <span class="fu">highlight</span>(<span class="at">i=</span><span class="dv">1</span>,<span class="at">part=</span><span class="st">"footer"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

<img data-src="chap4_files/figure-revealjs/unnamed-chunk-11-1.png" style="width:70.0%" class="r-stretch quarto-figure-center"><ul>
<li>가능도비 검정은 설명변수가 하나도 없는 영 모형(Null model)의 로그가능도와 현재 모형의 로그가능도를 비교한 것이다.</li>
</ul>
</section>
<section id="영모형" class="slide level2">
<h2>영모형</h2>
<ul>
<li>영모형의 로그가능도</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a>fit0<span class="ot">=</span><span class="fu">coxph</span>(<span class="fu">Surv</span>(time,status)<span class="sc">~</span><span class="dv">1</span>,<span class="at">data=</span>anderson)</span>
<span id="cb16-2"><a href="#cb16-2"></a>fit0</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:  coxph(formula = Surv(time, status) ~ 1, data = anderson)

Null model
  log likelihood= -93.18427 
  n= 42 </code></pre>
</div>
</div>
<ul>
<li>현재 모형의 로그가능도는 다음에서 알 수 있다.</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a>fit3<span class="sc">$</span>loglik</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -93.18427 -69.64839</code></pre>
</div>
</div>
</section>
<section id="section-2" class="slide level2">
<h2></h2>
<ul>
<li>가능도비검정에 쓰이는 LR 통계량은 영모형의 로그가능도에 -2를 곱한 값과 현재모형의 로그가능도에 -2를 곱한 값의 차이이다.</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a><span class="sc">-</span><span class="dv">2</span><span class="sc">*</span>(fit0<span class="sc">$</span>loglik)<span class="sc">-</span>(<span class="sc">-</span><span class="dv">2</span><span class="sc">*</span>(fit3<span class="sc">$</span>loglik[<span class="dv">2</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 47.07177</code></pre>
</div>
</div>
</section>
<section id="section-3" class="slide level2">
<h2></h2>
<ul>
<li>LR 통계량은 공변량의 갯수를 자유도로 하는 카이제곱분포를 따른다. 가능도비검정결과의 p값은 다음 R코드로 얻을 수 있다. 이 값은 R의 출력결과와 동일하다.</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a><span class="fu">pchisq</span>(<span class="fl">47.07177</span>,<span class="at">df=</span><span class="dv">3</span>,<span class="at">lower.tail=</span><span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3.355553e-10</code></pre>
</div>
</div>
</section>
<section id="모형의-비교-상호작용을-포함할-것인가" class="slide level2">
<h2>모형의 비교: 상호작용을 포함할 것인가?</h2>
<div class="sourceCode" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a><span class="fu">modelsSummaryTable</span>(<span class="fu">list</span>(fit1,fit2,fit3)) <span class="sc">%&gt;%</span> <span class="fu">highlight</span>(<span class="at">i=</span><span class="dv">9</span>,<span class="at">j=</span><span class="dv">6</span>,<span class="at">part=</span><span class="st">"all"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

<img data-src="chap4_files/figure-revealjs/unnamed-chunk-16-1.png" style="width:70.0%" class="r-stretch quarto-figure-center"><ul>
<li>Wald 검정</li>
<li>가능도비 검정</li>
<li>AIC(Akaike information criterion)</li>
</ul>
</section>
<section id="가능도비-검정-1" class="slide level2">
<h2>가능도비 검정</h2>
<p>상호작용이 없는 두 번 째 모형과 가능도비검정을 하기 위해 LR 통계량을 구해보면 다음과 같다.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a><span class="sc">-</span><span class="dv">2</span><span class="sc">*</span>(fit2<span class="sc">$</span>loglik[<span class="dv">2</span>]<span class="sc">-</span>fit3<span class="sc">$</span>loglik[<span class="dv">2</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.3594296</code></pre>
</div>
</div>
<p>이 통계량은 두 모형의 공변량의 갯수의 차이를 자유도로 하는 카이제곱분포를 따르므로 p값은 다음과 같다.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a><span class="fu">pchisq</span>(<span class="fl">0.3594296</span>,<span class="at">df=</span><span class="dv">1</span>,<span class="at">lower.tail=</span><span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.5488232</code></pre>
</div>
</div>
</section>
<section id="section-4" class="slide level2">
<h2></h2>
<p>이 값을 카이제곱분포곡선에서 확인해보면 다음과 같다.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a><span class="fu">draw_x2</span>(<span class="at">q=</span><span class="fl">0.3594296</span>,<span class="at">df=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="chap4_files/figure-revealjs/unnamed-chunk-19-1.png" style="width:70.0%" class="r-stretch quarto-figure-center"><p>가능도비 검정의 p값(0.549)은 Wald test의 p값(0.546)과 같지는 않지만 거의 비슷한 결과을 보여준다. 만약 두 검정 결과가 다르다면 가능도비 검정이 보다 좋은 통계학적 특성을 가지고 있기 때문에 가능도비 검정을 사용해야 한다.</p>
</section>
<section id="aic를-이용한-모형의-선택" class="slide level2">
<h2>AIC를 이용한 모형의 선택</h2>
<ul>
<li><span class="math inline">\(AIC=2k-2log(\hat{L})\)</span>으로 계산되는데 <span class="math inline">\(k\)</span>는 공변량의 갯수이고 <span class="math inline">\(log(\hat{L})\)</span>는 로그가능도이다.</li>
<li>모형 3의 AIC 값은</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a><span class="dv">2</span><span class="sc">*</span><span class="dv">3-2</span><span class="sc">*</span>fit3<span class="sc">$</span>loglik[<span class="dv">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 145.2968</code></pre>
</div>
</div>
</section>
<section id="section-5" class="slide level2">
<h2></h2>
<ul>
<li>AIC 값은 낮을수록 좋은 모형이며 drop1()을 사용하면 현재모형과 설명변수를 하나 누락시킨 모형의 AIC 값을 비교해준다.</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a><span class="fu">drop1</span>(fit3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Single term deletions

Model:
Surv(time, status) ~ rx * logWBC
          Df    AIC
&lt;none&gt;       145.30
rx:logWBC  1 143.66</code></pre>
</div>
</div>
<ul>
<li>모형3에 비해 모형2 가 더 좋은 모형이다.</li>
</ul>
</section>
<section id="모형2와-모형-1의-비교" class="slide level2">
<h2>모형2와 모형 1의 비교</h2>
<p>모형2와 모형 1을 가능도비검정으로 비교해보면 다음과 같다.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a>LR<span class="ot">=</span><span class="sc">-</span><span class="dv">2</span><span class="sc">*</span>(fit1<span class="sc">$</span>loglik[<span class="dv">2</span>]<span class="sc">-</span>fit2<span class="sc">$</span>loglik[<span class="dv">2</span>])</span>
<span id="cb34-2"><a href="#cb34-2"></a><span class="fu">pchisq</span>(LR,<span class="at">df=</span><span class="dv">1</span>,<span class="at">lower.tail=</span><span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3.587325e-08</code></pre>
</div>
</div>
<ul>
<li><p>모형2의 Wald 검정(p&lt; 0.001) 및 가능도비검정(p&lt; 0.001) 결과 모형2의 예측변수 logWBC 는 통계적으로 유의한 변수임을 알 수 있다.</p></li>
<li><p>따라서 세 가지 모형 중 모형 2가 가장 좋은 모형으로 결론내릴 수 있다.</p></li>
<li><p>모형 2의 rx에 대한 기술은 “<strong>logWBC의 효과를 보정한 후 치료효과는 통계적으로 유의하며 위험비는 4.0(95% 신뢰구간 1.74-9.20)으로 추정된다.</strong>”라고 기술할 수 있다.</p></li>
</ul>
</section>
<section id="모형2의-위험비" class="slide level2">
<h2>모형2의 위험비</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a><span class="fu">modelPlot</span>(fit2,<span class="at">widths=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="fl">2.1</span>,<span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="chap4_files/figure-revealjs/unnamed-chunk-23-1.png" style="width:70.0%" class="r-stretch quarto-figure-center"></section>
<section id="보정된-생존곡선" class="slide level2">
<h2>보정된 생존곡선</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1"></a><span class="fu">adjustedPlot</span>(fit2,<span class="at">xnames=</span><span class="st">"rx"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="chap4_files/figure-revealjs/unnamed-chunk-24-1.png" style="width:70.0%" class="r-stretch quarto-figure-center"></section>
<section id="콕스ph모형-식formula" class="slide level2" data-background="#43464B">
<h2>콕스PH모형 식(Formula)</h2>
</section>
<section id="콕스ph모형-식formula-1" class="slide level2">
<h2>콕스PH모형 식(Formula)</h2>
<p>설명변수 <span class="math inline">\(\mathbf{X}=(X_1,X_2,...,X_p)\)</span>가 있는 콕스비례위험모형의 위험함수는 다음 식으로 표현할 수 있다.</p>
<p><span class="math display">\[h(t,\mathbf{X}) = h_0(t) \times e^{\sum_{i=1}^{p} \beta_iX_i}\]</span></p>
<ul>
<li>위의 위험함수는 설명변수 X를 가진 어떤 대상환자에서 t시간에서의 위험을 나타낸 것이다.</li>
</ul>
</section>
<section id="section-6" class="slide level2">
<h2></h2>
<table>
<thead>
<tr class="header">
<th style="text-align: center;"><span class="math inline">\(h_0(t)\)</span></th>
<th style="text-align: center;"><span class="math inline">\(exp(\sum_{i=1}^k\beta_iX_i)\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Baseline hazard</td>
<td style="text-align: center;">exponential</td>
</tr>
<tr class="even">
<td style="text-align: center;">Involves <span class="math inline">\(t\)</span></td>
<td style="text-align: center;">Involves <span class="math inline">\(X\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: center;">but not <span class="math inline">\(X\)</span>’s</td>
<td style="text-align: center;">not not <span class="math inline">\(t\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;"></td>
<td style="text-align: center;"><span class="math inline">\(X\)</span>’s are <strong>time-independent</strong></td>
</tr>
</tbody>
</table>
</section>
<section id="xs-involing-t" class="slide level2">
<h2><span class="math inline">\(X\)</span>’s involing t</h2>
<ul>
<li>time-dependent covariate</li>
<li>requires extended Cox model(no PH) (chapter 7)</li>
</ul>
</section>
<section id="time-independent-variables" class="slide level2">
<h2>Time-independent variables</h2>
<ul>
<li>Values for a given individual do not change over time</li>
<li>Sex, Smoking status : assumed not to change once measured</li>
<li>Age, Weight : do not change much or effect on survival depends on one measurement</li>
</ul>
</section>
<section id="기저위험함수" class="slide level2">
<h2>기저위험함수</h2>
<ul>
<li>모든 공변량이 0일 경우 시간 <span class="math inline">\(t\)</span>에서의 위험함수는 <span class="math inline">\(h_0(t)\)</span>와 같아지며 이와 같은 특성 때문에 <span class="math inline">\(h_0(t)\)</span>를 <strong>기저위험함수</strong>라 부른다.</li>
</ul>
<p><span class="math display">\[\begin{align*}
h(t,\mathbf{X}) &amp;= h_0(t) \times e^{\sum_{i=1}^{p} \beta_iX_i} \\
&amp;= h_0(t) \times e^0 \longleftarrow X_1=X_2=...X_p=0 \\
&amp;=h_0(t)
\end{align*}\]</span></p>
<div class="fragment">
<ul>
<li>또한 공변량이 없는 경우에도 시간 <span class="math inline">\(t\)</span>에서의 위험함수 <span class="math inline">\(h(t,X)=h_0(t)\)</span>가 된다.</li>
</ul>
</div>
</section>
<section id="cox-model-semiparametric" class="slide level2">
<h2>Cox model: semiparametric</h2>
<ul>
<li><p>콕스PH모형의 기저위험함수 <span class="math inline">\(h_0(t)\)</span>는 모수적 가정을 하지 않으므로 준모수적인(semiparametric) 방법이라고 할 수 있다.</p></li>
<li><p>기저위험함수의 분포가 알려져 있는 모수적인 회귀모형을 사용한 생존분석 방법도 있는데 와이블(Weibull) 모형이 대표적이며 이는 제 8장에서 다룬다.</p></li>
</ul>
</section>
<section id="why-the-cox-ph-model-is-popular" class="slide level2" data-background="#43464B">
<h2>Why the Cox PH Model Is Popular ?</h2>
</section>
<section id="콕스ph모형의-강점1" class="slide level2">
<h2>콕스PH모형의 강점(1)</h2>
<ul>
<li><p>Cox PH model is <strong>robust</strong> : Will closely approximate correct parametric method</p></li>
<li><p>If correct model is:</p>
<ul>
<li>Weibull -&gt; Cox model will approximate Weibull</li>
<li>Exponential -&gt; Cox model will approximate exponential</li>
</ul></li>
</ul>
<div class="fragment">
<ul>
<li><p>Prefer parametric model if sure of correct model, e.g., use of goodness-of-fit test.</p></li>
<li><p>When in doubt, the Cox model is a <strong>safe</strong> choice</p></li>
</ul>
</div>
</section>
<section id="콕스ph모형의-강점2" class="slide level2">
<h2>콕스PH모형의 강점(2)</h2>
<ul>
<li><p>콕스모형의 위험함수 식 중 지수부분인 <span class="math inline">\(e^{\sum_{i=1}^{p} \beta_iX_i}\)</span>에 강점이 있다.</p></li>
<li><p>이 지수부분의 값은 항상 0 보다 큰 값이 되기 때문에 위험비가 0부터 무한대의 값을 가질 수 있다(<span class="math inline">\(0 \leq h(t,X) \leq \infty\)</span>).</p></li>
</ul>
</section>
<section id="콕스ph모형의-강점3" class="slide level2">
<h2>콕스PH모형의 강점(3)</h2>
<ul>
<li><p>기저위험함수인 <span class="math inline">\(h_0(t)\)</span>를 계산할 필요없이 회귀계수 및 위험비의 추정이 가능하고 보정된 생존 곡선을 얻을 수 있다는 점이다</p></li>
<li><p>마지막으로 생존시간 및 중도탈락에 대한 정보가 있다면 생존시간 및 중도탈락에 대한 정보를 무시하는 로지스틱회귀모형보다 콕스PH모형이 보다 선호된다.</p></li>
</ul>
</section>
<section id="콕스ph모형에서-회귀계수의-추정" class="slide level2" data-background="#43464B">
<h2>콕스PH모형에서 회귀계수의 추정</h2>
</section>
<section id="콕스ph모형에서-회귀계수의-추정-1" class="slide level2">
<h2>콕스PH모형에서 회귀계수의 추정</h2>

<img data-src="chap4_files/figure-revealjs/unnamed-chunk-25-1.png" style="width:70.0%" class="r-stretch quarto-figure-center"><ul>
<li>최대가능도(maximum likelihood) 추정량 : <span class="math inline">\(\hat{\beta}_i\)</span></li>
<li>이 모형에서의 위험함수는 다음과 같이 추정할 수 있다.</li>
</ul>
<p><span class="math display">\[\hat{h}(t,X)=\hat{h}_0(t)\times e^{1.386rx+1.691logWBC}\]</span></p>
</section>
<section id="최대가능도-추정량ml-estimates" class="slide level2">
<h2>최대가능도 추정량(ML estimates)</h2>
<ul>
<li>가능도함수(likelihood function)을 최대화하는 추정량</li>
<li>가능도함수는 보통 <span class="math inline">\(L(\beta)\)</span>로 표기하는데 모형에서 고려할 여러 설명변수들( <span class="math inline">\(\beta\)</span>)의 함수라는 수학적인 표현이다.</li>
</ul>
</section>
<section id="l-is-a-partial-likelihood" class="slide level2">
<h2><span class="math inline">\(L\)</span> is a <strong>partial</strong> likelihood</h2>
<ul>
<li>콕스모형에서 사용하는 가능도함수는 <strong>부분</strong>가능도함수(<strong>partial</strong> likelihood)함수</li>
<li>실패한 대상의 확률만을 고려한다</li>
<li>중도절단된 대상들의 확률은 명시적으로 고려하지 않는다</li>
</ul>
</section>
<section id="부분가능도-함수의-계산" class="slide level2">
<h2>부분가능도 함수의 계산</h2>
<p><span class="math display">\[L=L_1\times L_2\times L_3\times ... \times L_k = \prod_{j=1}^k L_j\]</span></p>
<ul>
<li>부분가능도 함수는 <span class="math inline">\(k\)</span>개의 실패시간에 해당하는 여러 가능도들의 곱으로 쓸 수 있다.</li>
</ul>
</section>
<section id="section-7" class="slide level2">
<h2></h2>
<ul>
<li><span class="math inline">\(L_f\)</span>
<ul>
<li>“risk set” <span class="math inline">\(R(t_{(f)})\)</span>
<ul>
<li><span class="math inline">\(j\)</span>번째 실패시간까지 생존한 위험의 대상들</li>
<li>시간이 진행할수록 그 숫자가 감소한다.</li>
</ul></li>
<li>주어진 “risk set” <span class="math inline">\(R(t_{(f)})\)</span>에서 <span class="math inline">\(f\)</span>번째 실패시간의 가능도</li>
<li>그 시간까지 생존했다는 조건 하에 그 시간에 실패할 가능성을 나타내는 조건부 확률이다.</li>
</ul></li>
</ul>
</section>
<section id="중도절단-데이터" class="slide level2">
<h2>중도절단 데이터</h2>
<ul>
<li><p>부분가능도함수가 실패한 대상의 확률만을 고려하지만 중도절단된 대상들의 중도절단되기 전까지의 생존시간을 고려한다</p></li>
<li><p><span class="math inline">\(f\)</span>번째 실패시간 이후에 중도절단된 대상들은 <span class="math inline">\(L_f\)</span>를 계산할 때 risk set으로 사용된다.</p></li>
</ul>
</section>
<section id="steps-for-obtaining-ml-estimates" class="slide level2">
<h2>Steps for obtaining ML estimates</h2>
<ul>
<li>모형에서 가능도함수를 만든다.</li>
<li>가능도를 최대화하기 위해 컴퓨터를 사용하여 계산하는데 보통 로그가능도함수를 편미분한 방정식의 해를 구한다.</li>
</ul>
<p><span class="math display">\[\frac{\partial log L}{\partial \beta_i} =0,\ \ \  i=1,2,3,...,p\ \ (p=no\ of\ parameters)\]</span></p>
</section>
<section id="section-8" class="slide level2">
<h2></h2>
<ul>
<li>최대부분가능도추정량 <span class="math inline">\(\hat{\beta}\)</span>를 기반으로 누적위험함수를 구하기 위해 Breslow 추정량을 이용한다.</li>
</ul>
<p><span class="math display">\[\hat{H_0}(t)=\sum_{t_i&lt;t}\hat{h_0}(t)=\sum_{t_i&lt;t}\frac{1}{\sum_{j \in R_j} e^{\beta x_i}}\]</span></p>
<ul>
<li>이번 강의 끝 부분에 작은 데이터를 가지고 ML 추정량을 구해본다.</li>
</ul>
</section>
<section id="위험비의-계산" class="slide level2" data-background="#43464B">
<h2>위험비의 계산</h2>
</section>
<section id="위험비의-계산-1" class="slide level2">
<h2>위험비의 계산</h2>
<ul>
<li>위험비는 어떤 대상의 위험을 다른 대상의 위험으로 나눈 값이며 이들 대상은 설명변수 <span class="math inline">\(X\)</span>가 다른 대상이다.</li>
<li>어떤 대상의 설명변수들을 <span class="math inline">\(X^*\)</span>라고 하고 다른 대상의 설명변수들을 <span class="math inline">\(X\)</span>라고 하면 위험비는 다음과 같이 나타낼 수 있다.</li>
</ul>
<p><span class="math display">\[\hat{HR}=\frac{\hat{h}(t,X^*)}{\hat{h}(t,X)}\]</span> - 위험비가 1 보다 작은 경우보다 1보다 큰 경우가 해석하기 쉽기 때문에 보통 위험이 큰 대상을 <span class="math inline">\(X^*\)</span>(예: 대조군)로 하고 위험이 작은 대상을 <span class="math inline">\(X\)</span>로 한다(예: 치료군).</p>
</section>
<section id="section-9" class="slide level2">
<h2></h2>
<p><span class="math display">\[\hat{HR}=\frac{\hat{h}(t,X^*)}{\hat{h}(t,X)} =\frac{\hat{h_0}(t)\times e^{\sum_{i=1}^p \hat{\beta}X^*_i}}{\hat{h_0}(t)\times e^{\sum_{i=1}^p \hat{\beta}X_i}} = e^{\sum_{i=1}^p \hat{\beta_i}(X^*_i-X_i)}\]</span> <span class="math display">\[\hat{HR} =exp(\sum_{i=1}^p \hat{\beta_i}(X^*_i-X_i))\]</span></p>
<div class="fragment">
<ul>
<li>따라서 위험비의 계산에서 시간에 따라 변화하는 기저위험함수가 사라지고 설명변수와 회귀계수 부분만 남게 된다.</li>
<li>즉 위험비는 시간이 변하더라도 변하지 않고 일정하다.</li>
<li>따라서 콕스는 위험비를 “비례위험”이라고 하였다.</li>
</ul>
</div>
</section>
<section id="첫번째-모형-하나의-설명변수" class="slide level2">
<h2>첫번째 모형: 하나의 설명변수</h2>

<img data-src="chap4_files/figure-revealjs/unnamed-chunk-26-1.png" style="width:70.0%" class="r-stretch quarto-figure-center"><p>설명변수가 하나(<span class="math inline">\(X_1\)</span>)이고 0과 1로 표현할 수 있는 경우는 <span class="math inline">\(X^*_1=1\)</span>이 되고 <span class="math inline">\(X_1=0\)</span>이 된다.</p>
<p><span class="math display">\[\begin{align*}
\hat{HR}&amp;=exp(\hat{\beta_1}(X_1^*-X_1)) \\
&amp;=exp(\hat{\beta_1}(1-0))=e^{\hat{\beta_1}}= e^{1.572}=4.817
\end{align*}\]</span></p>
</section>
<section id="두번째모형-두-개의-설명변수" class="slide level2">
<h2>두번째모형 : 두 개의 설명변수</h2>

<img data-src="chap4_files/figure-revealjs/unnamed-chunk-27-1.png" style="width:70.0%" class="r-stretch quarto-figure-center"><p><span class="math inline">\(X^*=(1,logWBC)\)</span>이고 <span class="math inline">\(X=(0,logWBC)\)</span>이다. logWBC가 같을 경우 대조군과 치료군의 위험비는 다음과 같다.</p>
<p><span class="math display">\[\begin{align*}
\hat{HR}&amp;=exp(\hat{\beta_1}(X_1^*-X_1)+\hat{\beta_2}(X_2^*-X_2)) \\
&amp;=exp(1.386(1-0)+1.691(logWBC-logWBC)) \\
&amp;=e^{1.386(1)+1.691(0)}= e^{1.386}=3.999
\end{align*}\]</span></p>
</section>
<section id="세번째-모형-두-개의-설명변수와-상호작용" class="slide level2">
<h2>세번째 모형: 두 개의 설명변수와 상호작용</h2>

<img data-src="chap4_files/figure-revealjs/unnamed-chunk-28-1.png" style="width:70.0%" class="r-stretch quarto-figure-center"><p><span class="math inline">\(X^*=(1,logWBC,1\times logWBC)\)</span>이고 <span class="math inline">\(X=(0,logWBC, 0 \times logWBC)\)</span>이다.</p>
</section>
<section id="section-10" class="slide level2">
<h2></h2>
<p>logWBC가 같을 경우 대조군과 치료군의 위험비는 다음과 같다.</p>
<p><span class="math display">\[\begin{align*}
\small
\hat{HR}&amp;=exp(\sum_{i=0}^3 \hat{\beta_i}(X^*_i-X_i)) \\
&amp;=exp(2.375(1-0)+1.873(logWBC-logWBC)\\
&amp; \;\;\;\;\;\;\;\;\; -0.318(1\times logWBC -0 \times logWBC)) \\
&amp;=exp(2.375(1)-0.318\times logWBC)
\end{align*}\]</span></p>
<div class="fragment">
<p>대조군과 치료군의 logWBC가 2일 경우 위험비는 다음과 같이 계산된다.</p>
<p><span class="math display">\[\hat{HR}=exp(2.375(1)-0.318\times 2)=e^{1.739}=5.692\]</span></p>
</div>
</section>
<section id="콕스ph모형을-이용한-보정된-생존곡선" class="slide level2" data-background="#43464B">
<h2>콕스PH모형을 이용한 보정된 생존곡선</h2>
</section>
<section id="모형-1-rx에-따른-생존곡선-base-r" class="slide level2">
<h2>모형 1: rx에 따른 생존곡선: base R</h2>
<div class="sourceCode" id="cb38" data-code-line-numbers="1|2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1"></a>fit<span class="ot">=</span><span class="fu">survfit</span>(<span class="fu">Surv</span>(time,status)<span class="sc">~</span>rx,<span class="at">data=</span>anderson)</span>
<span id="cb38-2"><a href="#cb38-2"></a><span class="fu">plot</span>(fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="fragment">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="chap4_files/figure-revealjs/unnamed-chunk-29-1.png" style="width:70.0%"></p>
</figure>
</div>
</div>
</div>
</div>
</section>
<section id="모형2-보정된-생존곡선-base-r" class="slide level2">
<h2>모형2: 보정된 생존곡선: base R</h2>
<div class="sourceCode" id="cb39" data-code-line-numbers="1|2-4|5|6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1"></a>fit2<span class="ot">=</span><span class="fu">coxph</span>(<span class="fu">Surv</span>(time,status)<span class="sc">~</span>rx<span class="sc">+</span>logWBC,<span class="at">data=</span>anderson)</span>
<span id="cb39-2"><a href="#cb39-2"></a>rx<span class="ot">=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb39-3"><a href="#cb39-3"></a>logWBC<span class="ot">=</span><span class="fu">median</span>(anderson<span class="sc">$</span>logWBC)</span>
<span id="cb39-4"><a href="#cb39-4"></a>newdata<span class="ot">=</span><span class="fu">data.frame</span>(rx,logWBC)</span>
<span id="cb39-5"><a href="#cb39-5"></a><span class="fu">plot</span>(<span class="fu">survfit</span>(fit2,<span class="at">newdata=</span>newdata),<span class="at">col=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>,<span class="at">lty=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span>
<span id="cb39-6"><a href="#cb39-6"></a><span class="fu">legend</span>(<span class="st">"topright"</span>,<span class="at">legend=</span><span class="fu">c</span>(<span class="st">"treated"</span>,<span class="st">"control"</span>),<span class="at">col=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>,<span class="at">lty=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="fragment">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="chap4_files/figure-revealjs/unnamed-chunk-30-1.png" style="width:70.0%"></p>
</figure>
</div>
</div>
</div>
</div>
</section>
<section id="autoregadjustedplot" class="slide level2">
<h2>autoReg::adjustedPlot()</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1"></a>fit2<span class="ot">=</span><span class="fu">coxph</span>(<span class="fu">Surv</span>(time,status)<span class="sc">~</span>rx<span class="sc">+</span>logWBC,<span class="at">data=</span>anderson)</span>
<span id="cb40-2"><a href="#cb40-2"></a><span class="fu">adjustedPlot</span>(fit2,<span class="at">xnames=</span><span class="st">"rx"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="chap4_files/figure-revealjs/unnamed-chunk-31-1.png" style="width:70.0%" class="r-stretch quarto-figure-center"></section>
<section id="설명변수가-여러-개-있는-경우" class="slide level2">
<h2>설명변수가 여러 개 있는 경우</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1"></a><span class="fu">data</span>(cancer,<span class="at">package=</span><span class="st">"survival"</span>)</span>
<span id="cb41-2"><a href="#cb41-2"></a>fit<span class="ot">=</span><span class="fu">coxph</span>(<span class="fu">Surv</span>(time,status)<span class="sc">~</span>rx<span class="sc">+</span><span class="fu">strata</span>(sex)<span class="sc">+</span>age<span class="sc">+</span>differ,<span class="at">data =</span>colon)</span>
<span id="cb41-3"><a href="#cb41-3"></a><span class="fu">adjustedPlot</span>(fit,<span class="at">xnames=</span><span class="fu">c</span>(<span class="st">"sex"</span>,<span class="st">"rx"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="chap4_files/figure-revealjs/unnamed-chunk-32-1.png" style="width:70.0%" class="r-stretch quarto-figure-center"></section>
<section id="면분할" class="slide level2">
<h2>면분할</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1"></a><span class="fu">adjustedPlot</span>(fit,<span class="at">xnames=</span><span class="fu">c</span>(<span class="st">"rx"</span>,<span class="st">"sex"</span>,<span class="st">"differ"</span>),<span class="at">facet=</span><span class="fu">c</span>(<span class="st">"sex"</span>,<span class="st">"rx"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="chap4_files/figure-revealjs/unnamed-chunk-33-1.png" style="width:70.0%" class="r-stretch quarto-figure-center"></section>
<section id="add-95-ci" class="slide level2">
<h2>add 95% CI</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1"></a><span class="fu">adjustedPlot</span>(fit,<span class="at">xnames=</span><span class="fu">c</span>(<span class="st">"rx"</span>,<span class="st">"sex"</span>,<span class="st">"differ"</span>),<span class="at">facet=</span><span class="fu">c</span>(<span class="st">"sex"</span>,<span class="st">"rx"</span>),<span class="at">se=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="chap4_files/figure-revealjs/unnamed-chunk-34-1.png" style="width:70.0%" class="r-stretch quarto-figure-center"></section>
<section id="콕스가능도the-cox-likelihood" class="slide level2" data-background="#43464B">
<h2>콕스가능도(The Cox likelihood)</h2>
</section>
<section id="가능도likelihood" class="slide level2">
<h2>가능도(Likelihood)</h2>
<ul>
<li>가능도함수는 결과변수의 분포에 의존한다</li>
<li>하지만 콕스모형은 결과변수인 실패할 때까지의 시간(time to event)에 대해 가정하지 않는다.</li>
<li>콕스가능도는 이벤트의 분포가 아닌 이벤트의 관찰된 순서에 의존한다: <strong>부분가능도</strong>라고 불린다.</li>
</ul>
</section>
<section id="예제1" class="slide level2">
<h2>예제1</h2>
<ul>
<li>영희, 철수, 영수 3명이 계를 들었다.</li>
<li>계를 타는 사람은 일정한 시간 간격(<span class="math inline">\(t_j, j=1,2,...\)</span>)으로 뽑는다</li>
<li>한번 계를 탄 사람은 탈락되고 다시는 계를 탈 수 없다.</li>
<li>이때 영희가 먼저 계를 타고 그 후에 철수가 타고 제일 마지막으로 영수가 계를 탈 확률은?</li>
</ul>
<div class="fragment">
<p><span class="math display">\[Probability = \frac{1}{3} \times \frac{1}{2} \times \frac{1}{1}=\frac{1}{6}\]</span></p>
</div>
</section>
<section id="예제2" class="slide level2">
<h2>예제2</h2>
<ul>
<li>사람마다 계를 탈 수 있는 딱지(표)가 있다.</li>
<li>영희는 4장, 철수는 한 장, 영수는 두 장의 표를 가지고 있다</li>
<li>표를 모두 모은 후 무작위로 한 장을 선택해서 표의 주인이 계를 타는데 한 번 계를 탄 사람은 다음에는 제외된다</li>
<li>이 경우 영희, 철수, 영수 순으로 계를 탈 확률은 어떻게 될까?</li>
</ul>
<div class="fragment">
<p><span class="math display">\[Probability = \frac{4}{7} \times \frac{1}{3} \times \frac{1}{1}=\frac{4}{21}\]</span></p>
</div>
</section>
<section id="section-11" class="slide level2">
<h2></h2>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<table>
<thead>
<tr class="header">
<th style="text-align: left;">id</th>
<th style="text-align: right;">time</th>
<th style="text-align: right;">status</th>
<th style="text-align: right;">smoke</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">영희</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">철수</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">영수</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">기수</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="section-12" class="slide level2">
<h2></h2>
<p>흡연을 설명변수로 하는 콕스비례위험모형을 생각해보자.</p>
<p><span class="math display">\[h(t)=h_0(t)e^{\beta_1Smoke}\]</span></p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<table>
<thead>
<tr class="header">
<th style="text-align: left;">id</th>
<th style="text-align: left;">Hazard</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">영희</td>
<td style="text-align: left;"><span class="math inline">\(h_0(t)exp(\beta_1)\)</span></td>
</tr>
<tr class="even">
<td style="text-align: left;">철수</td>
<td style="text-align: left;"><span class="math inline">\(h_0(t)exp(0)\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: left;">영수</td>
<td style="text-align: left;"><span class="math inline">\(h_0(t)exp(0)\)</span></td>
</tr>
<tr class="even">
<td style="text-align: left;">기수</td>
<td style="text-align: left;"><span class="math inline">\(h_0(t)exp(\beta_1)\)</span></td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="첫번째-콕스가능도-l_1" class="slide level2">
<h2>첫번째 콕스가능도 <span class="math inline">\(L_1\)</span></h2>
<ul>
<li>2년째 영희에게 이벤트가 발생하였다</li>
<li>이 시기에 네명 모두 이벤트가 발생할 수 있는 위험대상이다.</li>
<li>첫번째 가능도(<span class="math inline">\(L_1\)</span>)는 네 명의 위험도를 분모에 놓고 영희의 위험도를 분자에 놓으면 된다.</li>
</ul>
<p><span class="math display">\[L_1=\frac{h_0(t)e^{\beta_1}}{h_0(t)e^{\beta_1}+h_0(t)e^0+h_0(t)e^0+h_0(t)e^{\beta_1}}\]</span></p>
</section>
<section id="두번째-콕스가능도-l_2" class="slide level2">
<h2>두번째 콕스가능도 <span class="math inline">\(L_2\)</span></h2>
<ul>
<li>철수는 3년째 이벤트가 발생하였다.</li>
<li>이때 위험대상은 철수,영수,기수 3명이다.</li>
<li>두번째 가능도(<span class="math inline">\(L_2\)</span>)는 세 사람의 위험도의 합을 분모로 하고 철수의 위험도를 분자로 한다.</li>
</ul>
<p><span class="math display">\[L_2=\frac{h_0(t)e^0}{h_0(t)e^0+h_0(t)e^0+h_0(t)e^{\beta_1}}\]</span></p>
</section>
<section id="세번째-콕스가능도-l_3" class="slide level2">
<h2>세번째 콕스가능도 <span class="math inline">\(L_3\)</span></h2>
<ul>
<li>다음 이벤트는 8년째 발생하였다.</li>
<li>영수는 5년째 중도절단되었으므로 8년째 위험대상은 기수 혼자이다.</li>
<li>따라서 <span class="math inline">\(L_3\)</span>은 다음과 같다.</li>
</ul>
<p><span class="math display">\[L_3=\frac{h_0(t)e^{\beta_1}}{h_0(t)e^{\beta_1}}\]</span></p>
</section>
<section id="콕스가능도" class="slide level2">
<h2>콕스가능도</h2>
<p>콕스가능도는 모든 가능도의 곱이며 기저위험함수인 <span class="math inline">\(h_0(t)\)</span>는 분자 분모에 모두 나타나므로 약분되어 생략하고 다음과 같이 나타낼 수 있다.</p>
<p><span class="math display">\[L=L_1\times L_2\times L_3\]</span> <span class="math display">\[L=[\frac{e^{\beta_1}}{e^{\beta_1}+e^0+e^0+e^{\beta_1}}]\times[\frac{e^0}{e^0+e^0+e^{\beta_1}}]\times[\frac{e^{\beta_1}}{e^{\beta_1}}]\]</span></p>
</section>
<section id="콕스가능도의-특성" class="slide level2">
<h2>콕스가능도의 특성</h2>
<ul>
<li>가장 중요한 특성은 기저위험함수가 각 식에서 약분되어 사라짐으로써 콕스모형을 만들 때 기저위험함수를 구체화할 필요가 없다는 점이다.</li>
<li>콕스가능도는 이벤트의 발생순서와 중도절단의 <strong>발생순서</strong>에 의해 결정되며 <strong>분포</strong>에 의존하지 않는다.</li>
</ul>
</section>
<section id="section-13" class="slide level2">
<h2></h2>
<div class="columns">
<div class="column" style="width:49%;">
<p>Data A</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<table>
<thead>
<tr class="header">
<th style="text-align: left;">name</th>
<th style="text-align: right;">t</th>
<th style="text-align: right;">s</th>
<th style="text-align: right;">smoke</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">영희</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">철수</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">영수</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">기수</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
</div>
</div><div class="column" style="width:2%;">

</div><div class="column" style="width:49%;">
<p>Data B</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<table>
<thead>
<tr class="header">
<th style="text-align: left;">name</th>
<th style="text-align: right;">t</th>
<th style="text-align: right;">s</th>
<th style="text-align: right;">smoke</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">영희</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">철수</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">영수</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">기수</td>
<td style="text-align: right;">63</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<ul>
<li>데이터 A와 데이터 B에서 시간이 다르지만 이벤트의 발생순서는 같다.</li>
<li>두 데이터에서 이벤트의 발생순서가 같기 때문에 콕스위험도는 동일하다.</li>
</ul>
</section>
<section id="콕스가능도의-일반화" class="slide level2">
<h2>콕스가능도의 일반화</h2>
<p>데이터에 <span class="math inline">\(k\)</span>개의 실패시간이 있을 때 <span class="math inline">\(f\)</span>번째 실패시간의 가능도를 <span class="math inline">\(L_f\)</span>라고 하면 콕스가능도는 k개의 항의 곱으로 나타난다.</p>
<p><span class="math display">\[L=L_1\times L_2 \times L_3 \times ... \times L_k=\prod_{f=1}^k L_f\]</span></p>
<p>다음 단계는 콕스가능도 <span class="math inline">\(L\)</span>을 최대화하는 회귀계수의 값을 추정하는 것이다. 추정을 위해 콕스가능도의 자연로그를 편미분한 식을 0으로 만드는 해를 구한다.(스코어 함수와 정보행렬을 이용한다.)</p>
<p><span class="math display">\[\frac{\partial In L}{\partial \beta_i} =0,\ \ \  i=1,2,3,...,p\ \ (p=no\ of\ parameters)\]</span></p>
</section>
<section id="회귀계수의-추정" class="slide level2">
<h2>회귀계수의 추정</h2>
<p>위의 예에서 콕스 가능도는 다음과 같았다.</p>
<p><span class="math display">\[L=[\frac{e^{\beta_1}}{e^{\beta_1}+e^0+e^0+e^{\beta_1}}]\times[\frac{e^0}{e^0+e^0+e^{\beta_1}}]\times[\frac{e^{\beta_1}}{e^{\beta_1}}]\]</span></p>
<p>이를 정리해보면 다음과 같다. 여기서 설명변수가 하나이므로 <span class="math inline">\(\beta1\)</span>을 <span class="math inline">\(\beta\)</span>로 표기한다.</p>
<p><span class="math display">\[\begin{align*}
L(\beta)&amp;=[\frac{e^\beta}{2e^\beta+2}]\times[\frac{1}{e^\beta+2}]\times 1 \\
&amp;=\frac{e^\beta}{(2e^{\beta}+2)\times (e^{\beta}+2)}
\end{align*}\]</span></p>
</section>
<section id="로그가능도" class="slide level2">
<h2>로그가능도</h2>
<p>양변의 로그를 취하면 로그가능도함수를 얻는다.</p>
<p><span class="math display">\[\begin{align*}
l(\beta)&amp;=log(\frac{e^\beta}{(2e^{\beta}+2)\times (e^{\beta}+2)}) \\
&amp;=log(e^\beta)-log(2e^\beta+2)-log(e^\beta+2)
\end{align*}\]</span></p>
</section>
<section id="로그가능도-함수-그래프" class="slide level2">
<h2>로그가능도 함수 그래프</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1"></a>pl <span class="ot">&lt;-</span> <span class="cf">function</span>(beta) {</span>
<span id="cb44-2"><a href="#cb44-2"></a>  psi <span class="ot">&lt;-</span> <span class="fu">exp</span>(beta)</span>
<span id="cb44-3"><a href="#cb44-3"></a>  result <span class="ot">&lt;-</span> <span class="fu">log</span>(psi) <span class="sc">-</span> <span class="fu">log</span>(<span class="dv">2</span><span class="sc">*</span>psi <span class="sc">+</span> <span class="dv">2</span>) <span class="sc">-</span> <span class="fu">log</span>(psi <span class="sc">+</span> <span class="dv">2</span>) </span>
<span id="cb44-4"><a href="#cb44-4"></a>  result</span>
<span id="cb44-5"><a href="#cb44-5"></a>}</span>
<span id="cb44-6"><a href="#cb44-6"></a></span>
<span id="cb44-7"><a href="#cb44-7"></a>beta<span class="ot">=</span><span class="fu">seq</span>(<span class="sc">-</span><span class="dv">2</span>,<span class="dv">2</span>,<span class="at">length.out=</span><span class="dv">100</span>)</span>
<span id="cb44-8"><a href="#cb44-8"></a><span class="fu">plot</span>(<span class="fu">pl</span>(beta) <span class="sc">~</span> beta, <span class="at">type=</span><span class="st">"l"</span>, <span class="at">xlab=</span><span class="st">"beta"</span>, <span class="at">ylab=</span><span class="st">"log partial likelihood"</span>,</span>
<span id="cb44-9"><a href="#cb44-9"></a>     <span class="at">cex.axis=</span><span class="fl">1.5</span>, <span class="at">cex.lab=</span><span class="fl">1.5</span>, <span class="at">lwd=</span><span class="dv">2</span>, <span class="at">col=</span><span class="st">"black"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="chap4_files/figure-revealjs/unnamed-chunk-39-1.png" style="width:70.0%" class="r-stretch quarto-figure-center"></section>
<section id="회귀계수-추정" class="slide level2">
<h2>회귀계수 추정</h2>
<ul>
<li>로그가능도함수의 값이 최대가 되는 <span class="math inline">\(\beta\)</span>의 값이 회귀계수의 추정치이다.</li>
<li>최대부분가능도 추정치(maximum partial likelyhood estimate)는 R의 optim함수로 얻을 수 있다.</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1"></a>result<span class="ot">=</span><span class="fu">optim</span>(<span class="at">par=</span><span class="dv">0</span>, <span class="at">fn =</span> pl, <span class="at">method =</span> <span class="st">"L-BFGS-B"</span>,</span>
<span id="cb45-2"><a href="#cb45-2"></a>                <span class="at">control=</span><span class="fu">list</span>(<span class="at">fnscale =</span> <span class="sc">-</span><span class="dv">1</span>), <span class="at">lower =</span> <span class="sc">-</span><span class="dv">3</span>, <span class="at">upper =</span> <span class="dv">1</span>)</span>
<span id="cb45-3"><a href="#cb45-3"></a>result<span class="sc">$</span>par</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.3465736</code></pre>
</div>
</div>
</section>
<section id="스코어-함수" class="slide level2">
<h2>스코어 함수</h2>
<ul>
<li>로그가능도함수를 미분한 함수가 스코어 함수이다.</li>
<li>스코어함수 값은 로그가능도함수 그래프의 기울기가 된다.</li>
</ul>
<p><span class="math display">\[\begin{align*}
U(\beta)&amp;=l'(\beta)=(log(e^\beta)-log(2e^\beta+2)-log(e^\beta+2))'\\
&amp;=\frac{e^\beta}{e^\beta}-\frac{2e^\beta}{2e^\beta+2}-\frac{e^\beta}{e^\beta+2}\\
&amp;=1-\frac{2e^\beta}{2e^\beta+2}-\frac{e^\beta}{e^\beta+2}
\end{align*}\]</span></p>
</section>
<section id="스코어-함수-그래프" class="slide level2">
<h2>스코어 함수 그래프</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1"></a>scoref<span class="ot">=</span><span class="cf">function</span>(beta){    </span>
<span id="cb47-2"><a href="#cb47-2"></a>   psi <span class="ot">&lt;-</span> <span class="fu">exp</span>(beta)</span>
<span id="cb47-3"><a href="#cb47-3"></a>   result<span class="ot">=</span><span class="dv">1-2</span><span class="sc">*</span>psi<span class="sc">/</span>(<span class="dv">2</span><span class="sc">*</span>psi<span class="sc">+</span><span class="dv">2</span>)<span class="sc">-</span>psi<span class="sc">/</span>(psi<span class="sc">+</span><span class="dv">2</span>)</span>
<span id="cb47-4"><a href="#cb47-4"></a>   result</span>
<span id="cb47-5"><a href="#cb47-5"></a>}</span>
<span id="cb47-6"><a href="#cb47-6"></a></span>
<span id="cb47-7"><a href="#cb47-7"></a><span class="fu">plot</span>(<span class="fu">scoref</span>(beta) <span class="sc">~</span> beta, <span class="at">type=</span><span class="st">"l"</span>, <span class="at">xlab=</span><span class="st">"beta"</span>, <span class="at">ylab=</span><span class="st">"score function"</span>,</span>
<span id="cb47-8"><a href="#cb47-8"></a>     <span class="at">cex.axis=</span><span class="fl">1.5</span>, <span class="at">cex.lab=</span><span class="fl">1.5</span>, <span class="at">lwd=</span><span class="dv">2</span>, <span class="at">col=</span><span class="st">"black"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="chap4_files/figure-revealjs/unnamed-chunk-41-1.png" style="width:70.0%" class="r-stretch quarto-figure-center"></section>
<section id="스코어-함수---회귀계수" class="slide level2">
<h2>스코어 함수 -&gt; 회귀계수</h2>
<p>스코어함수의 값이 0이 되는 <span class="math inline">\(\beta\)</span>의 값과 같다. 이 값은 uniroot함수로 구할 수 있다.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1"></a>result1 <span class="ot">&lt;-</span> <span class="fu">uniroot</span>(<span class="at">f =</span> scoref, <span class="at">interval=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>,<span class="dv">5</span>),<span class="at">tol =</span> .Machine<span class="sc">$</span>double.eps)</span>
<span id="cb48-2"><a href="#cb48-2"></a>result1<span class="sc">$</span>root</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.3465736</code></pre>
</div>
</div>
</section>
<section id="콕스모형에서-회귀계수" class="slide level2">
<h2>콕스모형에서 회귀계수</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1"></a>fit.cox<span class="ot">=</span><span class="fu">coxph</span>(<span class="fu">Surv</span>(time,status)<span class="sc">~</span>smoke)</span>
<span id="cb50-2"><a href="#cb50-2"></a>fit.cox<span class="sc">$</span>coef</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    smoke 
0.3465736 </code></pre>
</div>
</div>
</section>
<section id="스코어함수-값" class="slide level2">
<h2>스코어함수 값</h2>
<p>귀무가설인 <span class="math inline">\(\beta=0\)</span>에 해당하는 로그부분가능도 함수의 값은 -2.485이다. 점 (0,-2.485)에서 로그부분가능도 함수의 곡선에 접선을 그리면 그 접선의 기울기는 스코어 함수의 값이 된다.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1"></a><span class="fu">scoref</span>(<span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1666667</code></pre>
</div>
</div>
</section>
<section id="스코어함수-값-1" class="slide level2">
<h2>스코어함수 값</h2>
<ul>
<li>이 값은 흥미롭게도 로그순위검정의 U 통계량과 같다. 즉, 다음의 로그순위검정에서 관찰값-기대값의 합계와 같다.</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1"></a><span class="fu">library</span>(howto)</span>
<span id="cb54-2"><a href="#cb54-2"></a>fit<span class="ot">=</span><span class="fu">survfit</span>(<span class="fu">Surv</span>(time,status)<span class="sc">~</span>smoke)</span>
<span id="cb54-3"><a href="#cb54-3"></a><span class="fu">howto2</span>(fit,<span class="at">digits=</span><span class="dv">3</span>) <span class="sc">%&gt;%</span> <span class="fu">fontsize</span>(<span class="at">size=</span><span class="dv">15</span>,<span class="at">part=</span><span class="st">"all"</span>)<span class="sc">%&gt;%</span> <span class="fu">plot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="chap4_files/figure-revealjs/unnamed-chunk-45-1.png" style="width:70.0%" class="r-stretch quarto-figure-center"></section>
<section id="로그가능도-함수곡선의-접선" class="slide level2">
<h2>로그가능도 함수곡선의 접선</h2>
<p>다음 함수는 로그가능도 함수곡선의 임의의 <span class="math inline">\(\beta\)</span> 값에서 접선을 그려준다.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1"></a>add_tangent<span class="ot">=</span><span class="cf">function</span>(x,<span class="at">col=</span><span class="st">"black"</span>){</span>
<span id="cb55-2"><a href="#cb55-2"></a>   (<span class="at">y=</span><span class="fu">pl</span>(x))</span>
<span id="cb55-3"><a href="#cb55-3"></a>   <span class="fu">points</span>(x,y,<span class="at">col=</span>col,<span class="at">pch=</span><span class="dv">19</span>)</span>
<span id="cb55-4"><a href="#cb55-4"></a>   (<span class="at">slope=</span><span class="fu">scoref</span>(x))</span>
<span id="cb55-5"><a href="#cb55-5"></a>   intercept<span class="ot">=</span>y<span class="sc">-</span>slope<span class="sc">*</span>x</span>
<span id="cb55-6"><a href="#cb55-6"></a>   <span class="fu">abline</span>(<span class="at">a=</span>intercept,<span class="at">b=</span>slope,<span class="at">col=</span>col)</span>
<span id="cb55-7"><a href="#cb55-7"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="section-14" class="slide level2">
<h2></h2>
<p>이 함수을 이용해 로그부분가능도함수 곡선 및 최대로그부분가능도, <span class="math inline">\(\beta=0\)</span>일 때의 접선을 그려보면 다음과 같다.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1"></a><span class="fu">plot</span>(<span class="fu">pl</span>(beta) <span class="sc">~</span> beta, <span class="at">type=</span><span class="st">"l"</span>, <span class="at">xlab=</span><span class="st">"beta"</span>, <span class="at">ylab=</span><span class="st">"log partial likelihood"</span>,</span>
<span id="cb56-2"><a href="#cb56-2"></a>     <span class="at">cex.axis=</span><span class="fl">1.5</span>, <span class="at">cex.lab=</span><span class="fl">1.5</span>, <span class="at">lwd=</span><span class="dv">2</span>, <span class="at">col=</span><span class="st">"black"</span>)</span>
<span id="cb56-3"><a href="#cb56-3"></a><span class="fu">abline</span>(<span class="at">v=</span>result1<span class="sc">$</span>root, <span class="at">lty=</span><span class="dv">2</span>)</span>
<span id="cb56-4"><a href="#cb56-4"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="dv">0</span>, <span class="at">lty=</span><span class="dv">2</span>,<span class="at">col=</span><span class="st">"red"</span>)</span>
<span id="cb56-5"><a href="#cb56-5"></a><span class="fu">add_tangent</span>(<span class="dv">0</span>,<span class="at">col=</span><span class="st">"red"</span>)</span>
<span id="cb56-6"><a href="#cb56-6"></a><span class="fu">add_tangent</span>(result1<span class="sc">$</span>root)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="chap4_files/figure-revealjs/unnamed-chunk-47-1.png" style="width:70.0%" class="r-stretch quarto-figure-center"></section>
<section id="여러-개의-공변량이-있을-때-콕스부분가능도" class="slide level2" data-background="#43464B">
<h2>여러 개의 공변량이 있을 때 콕스부분가능도</h2>
</section>
<section id="여러-개의-공변량이-있을-때-콕스부분가능도-1" class="slide level2">
<h2>여러 개의 공변량이 있을 때 콕스부분가능도</h2>
<p>식을 간단히 하기 위해 <span class="math inline">\(i\)</span>번째 공변량 <span class="math inline">\(z_i\)</span>의 회귀계수를 <span class="math inline">\(\beta\)</span>라고 헀을 때 <span class="math inline">\(\psi=e^{z_i\beta}\)</span>로 정의한다. 부분가능도는 각 실패시간(1부터 <span class="math inline">\(j\)</span>)의 가능도의 곱으로 계산되며 <span class="math inline">\(j\)</span>번째 실패시간 <span class="math inline">\(t_j\)</span>의 가능도는 위험대상 <span class="math inline">\(R_j\)</span>의 모든 위험을 분모로 하고 위험대상 <span class="math inline">\(R_j\)</span>중 실패를 경험한 대상의 위험이 된다. <span class="math inline">\(D\)</span>는 위험대상 중 사망한 수를 나타낸다.</p>
<p><span class="math display">\[L(\beta)=\prod_{j=1}^D\frac{h_0(t_j)\psi_j}{\sum_{k \in R_j}h_0(t_j)\psi_k}=\prod_{j=1}^D\frac{\psi_j}{\sum_{k \in R_j}\psi_k}\]</span></p>
</section>
<section id="로그콕스부분가능도-스코어함수" class="slide level2">
<h2>로그콕스부분가능도, 스코어함수</h2>
<p>위의 콕스부분가능도 함수의 로그를 취하면 로그콕스부분가능도가 된다.</p>
<p><span class="math display">\[l(\beta)=\sum_{j=1}^D[log(\psi_j)-log(\sum_{k \in R_j}\psi_k)]=\sum_{j=1}^D z_j\beta-\sum_{j=1}^{D} log(\sum_{k \in R_j}e^{z_k\beta})\]</span></p>
<p>스코어 함수는 로그콕스부분가능도 <span class="math inline">\(l(\beta)\)</span>를 미분한 것으로 공변량의 갯수가 <span class="math inline">\(j\)</span>개인 경우 <span class="math inline">\(j\)</span>개로 구성된다. 스코어함수의 l번째 구성성분은 다음과 같다.</p>
<p><span class="math display">\[S_l(\beta)=\frac{\partial l(\beta)}{\partial \beta_l}=\sum_{j=1}^{D}[z_{jl}-\frac{\sum_{k \in Rj}z_{jk}e^{z_j\beta}}{\sum_{k \in Rj}e^{z_j\beta}}]\]</span></p>
<p>위의 식에서 <span class="math inline">\(log(\psi_j)=z_j\beta\)</span>이고 <span class="math inline">\(z_{jl}=\partial log(\psi_j)/\partial\beta_l\)</span>이다.</p>
</section>
<section id="정보행렬" class="slide level2">
<h2>정보행렬</h2>
<p>k개의 공변량들의 모든 가능한 조합을 갖는 로그부분가능도를 두 번 미분하면 정보행렬(information matrix)을 얻을 수 있다.</p>
<p><span class="math display">\[I(\beta;z)=-\frac{\partial^2l(\beta)}{\partial \beta \partial \beta'}=-\frac{\partial S(\beta)}{\partial \beta}\]</span></p>
<p>위의 정보행렬은 헤시안 행렬(Hessian matrix)이라고도 알려져 있다.</p>
</section>
<section id="왈드통계량x2_w-스코어통계량x2_s-로그가능도검정통계량x2_l" class="slide level2">
<h2>왈드통계량(<span class="math inline">\(X^2_w\)</span>), 스코어통계량(<span class="math inline">\(X^2_s\)</span>), 로그가능도검정통계량(<span class="math inline">\(X^2_l\)</span>)</h2>
<p>귀무가설 <span class="math inline">\(H_0:\beta=0\)</span>에 대한 왈드통계량(<span class="math inline">\(X^2_w\)</span>), 스코어통계량(<span class="math inline">\(X^2_s\)</span>), 로그가능도검정통계량(<span class="math inline">\(X^2_l\)</span>)은 다음과 같다.</p>
<p><span class="math display">\[X^2_w=\hat{\beta}'I(\hat{\beta};z)\hat{\beta}\]</span> <span class="math display">\[X^2_s=S'(\beta=0;z) \times I^{-1}(\beta=0;z)\times S(\beta;z)\]</span> <span class="math display">\[X^2_l=2\{l(\beta=\hat\beta )-l(\beta=0)\}\]</span></p>
<p>세 개의 통계량은 모두 공변량의 갯수를 자유도를 갖는 카이제곱분포를 따른다.</p>
</section>
<section id="콕스모형-summary" class="slide level2">
<h2>콕스모형 summary</h2>
<p>R에서 콕스모형에 적합시킨 후 모형을 summary()로 확인할 경우 세 개의 통계량을 모두 볼 수 있다.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1"></a><span class="fu">library</span>(autoReg)</span>
<span id="cb57-2"><a href="#cb57-2"></a><span class="fu">summary</span>(<span class="fu">coxph</span>(<span class="fu">Surv</span>(time,status)<span class="sc">~</span>rx<span class="sc">+</span>logWBC,<span class="at">data=</span>anderson))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(time, status) ~ rx + logWBC, data = anderson)

  n= 42, number of events= 30 

         coef exp(coef) se(coef)     z Pr(&gt;|z|)    
rx     1.3861    3.9991   0.4248 3.263   0.0011 ** 
logWBC 1.6909    5.4243   0.3359 5.034  4.8e-07 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

       exp(coef) exp(-coef) lower .95 upper .95
rx         3.999     0.2501     1.739     9.195
logWBC     5.424     0.1844     2.808    10.478

Concordance= 0.852  (se = 0.04 )
Likelihood ratio test= 46.71  on 2 df,   p=7e-11
Wald test            = 33.6  on 2 df,   p=5e-08
Score (logrank) test = 46.07  on 2 df,   p=1e-10</code></pre>
</div>
</div>
<div class="footer footer-default">

</div>
</section>
    </div>
  </div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="chap4_files/libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="chap4_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="chap4_files/libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="chap4_files/libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="chap4_files/libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="chap4_files/libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="chap4_files/libs/revealjs/plugin/notes/notes.js"></script>
  <script src="chap4_files/libs/revealjs/plugin/search/search.js"></script>
  <script src="chap4_files/libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="chap4_files/libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'smaller': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: false,

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    
    <script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        function fireSlideChanged(previousSlide, currentSlide) {

          // dispatch for htmlwidgets
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for reveal
        if (window.Reveal) {
          window.Reveal.addEventListener("slidechanged", function(event) {
            fireSlideChanged(event.previousSlide, event.currentSlide);
          });
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script>

    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const clipboard = new window.ClipboardJS('.code-copy-button', {
        target: function(trigger) {
          return trigger.previousElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        setTimeout(function() {
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      });
      function tippyHover(el, contentFn) {
        const config = {
          allowHTML: true,
          content: contentFn,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'quarto-reveal',
          placement: 'bottom-start'
        };
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          return note.innerHTML;
        });
      }
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const cites = ref.parentNode.getAttribute('data-cites').split(' ');
        tippyHover(ref, function() {
          var popup = window.document.createElement('div');
          cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    });
    </script>
    

</body></html>